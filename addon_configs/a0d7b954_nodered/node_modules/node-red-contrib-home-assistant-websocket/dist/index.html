<script src="resources/node-red-contrib-home-assistant-websocket/select2.full.min.js?v=4.1.0-rc.0"></script><link rel="stylesheet" href="resources/node-red-contrib-home-assistant-websocket/select2.min.css?v=4.1.0-rc.0"><script src="resources/node-red-contrib-home-assistant-websocket/maximize-select2-height.min.js?v=1.0.4"></script><script type="text/html" data-template-name="ha_entity_filter"><div class="form-row ha-entity-search-row"><label data-i18n="home-assistant.label.filter_results_label"></label> <input type="text"></div><div class="form-row ha-entity-search-row"><ul></ul></div></script>
<script type="text/javascript">!function(){"use strict";const e=(e,t)=>{let a=RED._(`node-red-contrib-home-assistant-websocket/all:${e}`,t);return-1!==a.indexOf("\n")&&(a=a.split("\n").map((e=>`<p>${e}</p>`)).join("")),a};function t(e,a){if(e===a)return!0;if("object"!=typeof e||"object"!=typeof a||null==e||null==a)return!1;const n=Object.keys(e),i=Object.keys(a);if(n.length<i.length)return!1;for(const o of i){if(!n.includes(o))return!1;if(!t(e[o],a[o]))return!1}return!0}function a(e,t){return e.split(".").reduce(((e,t)=>e[t]),t)}function n(e){return e&&(e instanceof jQuery||e.constructor.prototype.jquery)}const i=e=>{const t=n(e)?e:$(e);t.on("select2:unselecting",(()=>{t.on("select2:opening",(e=>{e.preventDefault(),t.off("select2:opening")}))}))},o={},s={},r={},l={},p={};function u(e){return e.split("/")[2]}function d(e,t){const a=e.label,n=t.label;return a===n?0:a.localeCompare(n)}function c(e){var t;return null!==(t=o[e])&&void 0!==t?t:[]}function v(e){var t;return null!==(t=s[e])&&void 0!==t?t:[]}function y(e,t,a="."){return Object.keys(e).reduce(((n,i)=>{const o=e[i],s=[t,i].filter(Boolean).join(a);return["object"==typeof o,null!==o,!(o instanceof Date),!(o instanceof RegExp),!(Array.isArray(o)&&0===o.length)].every(Boolean)?Object.assign(Object.assign({},n),y(o,s,a)):Object.assign(Object.assign({},n),{[s]:o})}),{})}function h(e){function t(e){let t,a=1;return"string"==typeof e&&e.startsWith("-")?(a=-1,t=e.substring(1)):t=e,function(e,n){const i=e[t],o=n[t];return("string"==typeof i&&"string"==typeof o?i.localeCompare(o):e[t]<n[t]?-1:e[t]>n[t]?1:0)*a}}return function(a,n){let i=0,o=0;const s=null==e?void 0:e.length;for(;0===o&&i<s;)o=t(e[i])(a,n),i++;return o}}let g;const f={show:t=>{RED.view.state(RED.state.EDITING);const a={title:e("home-assistant.label.filter_results_title"),width:"inherit",buttons:[{id:"node-dialog-cancel",text:e("home-assistant.label.cancel"),click:()=>{RED.tray.close()}},{id:"node-dialog-ok",text:e("home-assistant.label.done"),class:"primary",click:()=>{t.complete(g),RED.tray.close()}}],open:a=>{const n=a.find(".red-ui-tray-body");RED.editor.buildEditForm(n,"dialog-form","ha_entity_filter","node-red-contrib-home-assistant-websocket/all"),a.i18n(),$("#dialog-form").addClass("home-assistant"),n.find("select").val(t.filterType),n.find("input").val(t.filter).on("input",(a=>{const i=((e,t,a)=>{let n;if("regex"===a)try{const a=new RegExp(t);n=e.filter((e=>a.test(e.entity_id)))}catch(e){n=[]}else"substring"===a&&(n=e.filter((e=>e.entity_id.includes(t))));return n.sort(h(["entity_id"]))})(t.entities,a.target.value,t.filterType);g=a.target.value,n.find("ul").html((t=>t.length?t.map((e=>`<li>${e.entity_id}</li>`)).join(""):`<li>${e("home-assistant.label.no_matches_found")}</li>`)(i))})).trigger("input")}};RED.tray.show(a)}};let m;const b={};function _(){let e=$("#node-input-server").val();if("ha-button"===m.type){const t=RED.nodes.node($("#node-input-entityConfig").val());e=null==t?void 0:t.server}if(e&&"_ADD_"!==e)return e}function T(){const e=_();return!(!e||!b[e]||"0"===b[e])}function w(e){m=e,function(){switch(m.type){case"ha-webhook":case"ha-entity":j();break;case"ha-button":"_ADD_"!==$("#node-input-entityConfig").val()&&j("1.0.4");break;default:!function(){const e=$("<div />",{id:"exposeToHa",class:"form-row checkbox-option"+("trigger-state"===m.type?"-left":"")});$("<input />",{type:"checkbox",id:"node-input-exposeToHomeAssistant",checked:m.exposeToHomeAssistant}).on("change",(function(){$("#haConfigRow").toggle(!0===$("#node-input-exposeToHomeAssistant").is(":checked"))})).appendTo(e),$("<label />",{for:"node-input-exposeToHomeAssistant",text:"Expose to Home Assistant"}).appendTo(e);const t=$("<div />",{class:"form-row",id:"haConfigRow"}),a=$("<ol />",{id:"haConfig"}).appendTo(t),n=m.haConfig||[{property:"name",value:""},{property:"icon",value:""}];a.editableList({addButton:!1,header:$("<div>Home Assistant Config (optional)</div>"),addItem:function(e,t,a){const n=$("<div />").appendTo(e),i=$("<label>").appendTo(n);$("<span>").text(a.property.replace(/_/g," ")).appendTo(i),$("<input />",{type:"hidden",name:"property",value:a.property}).appendTo(i),$("<input />",{type:"text",name:"value",value:a.value}).attr("autocomplete","disable").appendTo(i)}}).editableList("addItems",n),$("#dialog-form").append(e).append(t),$("#node-input-exposeToHomeAssistant").trigger("change")}()}}(),$("#node-input-server, #node-input-entityConfig").on("change",(()=>{switch(m.type){case"ha-webhook":case"ha-entity":j();break;case"ha-button":"_ADD_"!==$("#node-input-entityConfig").val()&&j("1.0.4");break;case"ha-device":j("0.5.0");break;default:!function(){T()||$("#node-input-exposeToHomeAssistant").prop("checked",!1).trigger("change");$("#exposeToHa").toggle(T())}()}}))}function I(){const e=[];return $("#haConfig").editableList("items").each((function(){const t=$(this);e.push({property:t.find("input[name=property]").val(),value:t.find("input[name=value]").val()})})),e}function j(e){const t=void 0===e||(a=e,n=function(){const e=_();return e&&b&&b[e]&&"0"!==b[e]?b[e]:"0"}(),(a=a.split(".").map((e=>e.padStart(5))).join("."))<=n.split(".").map((e=>e.padStart(5))).join("."));var a,n;const i=T()&&t;if(!$("#integrationAlert").length){const a=`\n            <div id="integrationAlert" class="ui-state-error ha-alert-box">\n                <strong>Attention:</strong> \n                This node requires <a href="https://github.com/zachowj/hass-node-red" target="_blank">Node-RED custom integration ${t?"":`version ${e}+`} <i class="fa fa-external-link external-link"></i></a> to be installed in Home Assistant for it to function.\n            </div>`;$("#dialog-form").prepend(a)}$("#integrationAlert").toggle(!i)}const x={"ha-api":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>{const t=Object.assign(Object.assign({},e),{version:1,outputProperties:[],location:void 0,locationType:void 0});return"none"!==e.locationType&&(t.outputProperties=[{property:e.location,propertyType:e.locationType,value:"",valueType:"results"}]),t}}],"api-call-service":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>{const t=Object.assign(Object.assign({},e),{version:1});try{const a=JSON.parse(e.data);a.entity_id?(t.entityId=a.entity_id,delete a.entity_id,t.data=Object.keys(a).length?JSON.stringify(a):""):t.entityId=""}catch(e){}return t}},{version:2,up:e=>{const t=Object.assign(Object.assign({},e),{version:2,outputProperties:[]});return"none"!==e.output_location_type&&(t.outputProperties=[{property:e.output_location,propertyType:e.output_location_type,value:"",valueType:"data"}]),t}},{version:3,up:e=>Object.assign(Object.assign({},e),{version:3,queue:"none"})},{version:4,up:e=>Object.assign(Object.assign({},e),{version:4,target:{entityId:(null==e?void 0:e.entityId)?e.entityId.split(",").map((e=>e.trim())):[],areaId:[],deviceId:[]},domain:e.service_domain,mergeContext:e.mergecontext,entityId:void 0,service_domain:void 0,mergecontext:void 0})},{version:5,up:e=>{var t,a,n;return Object.assign(Object.assign({},e),{version:5,areaId:null===(t=e.target)||void 0===t?void 0:t.areaId,deviceId:null===(a=e.target)||void 0===a?void 0:a.deviceId,entityId:null===(n=e.target)||void 0===n?void 0:n.entityId,target:void 0})}}],server:[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,ha_boolean:e.ha_boolean||"y|yes|true|on|home|open",rejectUnauthorizedCerts:void 0===e.rejectUnauthorizedCerts||e.rejectUnauthorizedCerts,connectionDelay:void 0===e.connectionDelay||e.connectionDelay,cacheJson:void 0===e.cacheJson||e.cacheJson})},{version:2,up:e=>Object.assign(Object.assign({},e),{version:2,heartbeat:!1,heartbeatInterval:30})}],"api-current-state":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,blockInputOverrides:!1,entity_location:"data",halt_if_compare:"is",override_payload:!1===e.override_payload?"none":"msg",override_data:!1===e.override_data?"none":"msg",state_location:"payload",state_type:"str"})},{version:2,up:e=>{const t=Object.assign(Object.assign({},e),{version:2,outputProperties:[],state_location:void 0,override_payload:void 0,entity_location:void 0,override_data:void 0,override_topic:void 0});return"none"!==e.override_payload&&t.outputProperties.push({property:e.state_location,propertyType:e.override_payload,value:"",valueType:"entityState"}),"none"!==e.override_data&&t.outputProperties.push({property:e.entity_location,propertyType:e.override_data,value:"",valueType:"entity"}),!0===e.override_topic&&t.outputProperties.push({property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}),t}},{version:3,up:e=>Object.assign(Object.assign({},e),{version:3,for:0,forType:"num",forUnits:"minutes"})}],"ha-device":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})}],"ha-entity":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,inputOverride:"allow"})},{version:2,up:e=>{const t=Object.assign(Object.assign({},e),{version:2});return t.config.push({property:"state_class",value:""}),t.config.push({property:"last_reset",value:""}),t}}],"server-events":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0,waitForRunning:void 0===e.waitForRunning||e.waitForRunning})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,outputProperties:[{property:"payload",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:'$outputData("eventData").event_type',valueType:"jsonata"},{property:"event_type",propertyType:"msg",value:'$outputData("eventData").event_type',valueType:"jsonata"}]})}],"server-state-changed":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0,state_type:void 0!==e.state_type?e.state_type:"str",halt_if_type:void 0!==e.halt_if_type?e.halt_if_type:"str",halt_if_compare:void 0!==e.halt_if_compare?e.halt_if_compare:"is"})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,ignorePrevStateNull:!1,ignorePrevStateUnknown:!1,ignorePrevStateUnavailable:!1,ignoreCurrentStateUnknown:!1,ignoreCurrentStateUnavailable:!1})},{version:2,up:e=>Object.assign(Object.assign({},e),{version:2,for:void 0!==e.for?e.for:"0",forType:e.forType||"num",forUnits:e.forUnits||"minutes"})},{version:3,up:e=>Object.assign(Object.assign({},e),{version:3,outputProperties:[{property:"payload",propertyType:"msg",value:"",valueType:"entityState"},{property:"data",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}]})},{version:4,up:e=>{var t;const a=Object.assign(Object.assign({},e),{version:4});return"substring"===e.entityidfiltertype&&(null===(t=e.entityidfilter)||void 0===t?void 0:t.includes(","))&&(a.entityidfiltertype="list",a.entityidfilter=e.entityidfilter.split(",").map((e=>e.trim())).filter((e=>e.length>0))),a}}],"ha-fire-event":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})}],"ha-get-entities":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})}],"api-get-history":[{version:0,up:e=>{const t=Object.assign(Object.assign({},e),{version:0,output_type:void 0===e.output_type?"array":e.output_type});return void 0===t.output_location&&(t.output_location="payload",t.output_location_type="msg"),t}}],"poll-state":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,state_type:"str",halt_if_type:"str",halt_if_compare:"is",updateIntervalUnits:"seconds"})},{version:2,up:e=>Object.assign(Object.assign({},e),{version:2,updateIntervalType:"num"})}],"api-render-template":[{version:0,up:e=>{const t=Object.assign(Object.assign({},e),{version:0});return void 0===t.templateLocationType&&(t.templateLocation="template",t.templateLocationType="msg"),void 0===t.resultsLocationType&&(t.resultsLocation="payload",t.resultsLocationType="msg"),t}}],"trigger-state":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,inputs:1,enableInput:!0})},{version:2,up:e=>{var t;const a=Object.assign(Object.assign({},e),{version:2});return"substring"===e.entityidfiltertype&&(null===(t=e.entityid)||void 0===t?void 0:t.includes(","))&&(a.entityidfiltertype="list",a.entityid=e.entityid.split(",").map((e=>e.trim())).filter((e=>e.length>0))),a}}],"ha-tag":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,outputProperties:[{property:"payload",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}]})}],"ha-time":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>Object.assign(Object.assign({},e),{version:1,sunday:!0,monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!0})},{version:2,up:e=>{const t="jsonata"===e.payloadType&&"$entity().state"===e.payload;return Object.assign(Object.assign({},e),{version:2,outputProperties:[{property:"payload",propertyType:"msg",value:t?"":e.payload,valueType:t?"entityState":e.payloadType},{property:"data",propertyType:"msg",value:"",valueType:"entity"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],payload:void 0,payloadType:void 0})}}],"ha-wait-until":[{version:0,up:e=>{const t=Object.assign(Object.assign({},e),{version:0,entityIdFilterType:e.entityIdFilterType||"exact",timeoutType:e.timeoutType||"num"});return void 0===t.blockInputOverrides&&(t.blockInputOverrides=!0),void 0===t.checkCurrentState&&(t.checkCurrentState=!1),t}},{version:1,up:e=>{var t;const a=Object.assign(Object.assign({},e),{version:1});return"substring"===e.entityIdFilterType&&(null===(t=e.entityId)||void 0===t?void 0:t.includes(","))&&(a.entityIdFilterType="list",a.entityId=e.entityId.split(",").map((e=>e.trim())).filter((e=>e.length>0))),a}}],"ha-webhook":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})},{version:1,up:e=>{const t=Object.assign(Object.assign({},e),{version:1,outputProperties:[{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],payloadLocation:void 0,payloadLocationType:void 0,headersLocation:void 0,headersLocationType:void 0});return"none"!==e.payloadLocationType&&t.outputProperties.push({property:e.payloadLocation,propertyType:e.payloadLocationType,value:"",valueType:"data"}),"none"!==e.headersLocationType&&t.outputProperties.push({property:e.headersLocation,propertyType:e.headersLocationType,value:"",valueType:"headers"}),t}}],"ha-zone":[{version:0,up:e=>Object.assign(Object.assign({},e),{version:0})}]};function O(e){var t;const a=function(e){const t=k(e)||[];return t.reduce(((e,t)=>t.version>e?t.version:e),0)}(e.type);if(void 0!==e.version&&e.version>=a)return e;const n=null===(t=function(e,t=-1){const a=k(e);return a.find((e=>e.version===Number(t)+1))}(e.type,e.version))||void 0===t?void 0:t.up;if(n){return O(n(e))}return e}function k(e){return x[e]}let D;function E(e){const t=O(RED.nodes.convertNode(e,!1));for(const a in t)void 0===t[a]?delete e[a]:e[a]=t[a];e.changed=!0,RED.editor.updateNodeProperties(e);const a=$("#upgrade-ha-node");a.is(":visible")&&0===R()&&a.hide()}function L(){const t="home-assistant.ui.migrations",a=e(`${t}.button_ok`),n=e(`${t}.button_cancel`);$("#ha-dialog-confirm").dialog({resizable:!1,height:"auto",width:400,modal:!0,buttons:{[a]:function(){$(this).dialog("close"),function(){const t=e=>(C(e)&&!S(e)&&E(e),!0);RED.nodes.eachNode(t),RED.nodes.eachConfig(t),RED.nodes.dirty(!0),RED.notify(e("home-assistant.ui.migrations.all_nodes_updated")),RED.view.redraw()}()},[n]:function(){$(this).dialog("close")}}})}function S(e){const t=RED.settings.get(`${e.type.split("-").reduce(((e,t,a)=>e.concat(`${a?t[0].toUpperCase():t[0]}${t.slice(1)}`)),[]).join("")}Version`,-1);return void 0!==e.version&&e.version>=t}function C(e){const t=RED.nodes.registry.getNodeSetForType(e.type);return"node-red-contrib-home-assistant-websocket"===(null==t?void 0:t.module)}function R(){let e=0;const t=t=>(C(t)&&!S(t)&&e++,!0);return RED.nodes.eachNode(t),RED.nodes.eachConfig(t),e}const P="#custom-outputs";let A,V=[];const N={config:{value:"config",label:"config.",hasValue:!0},deviceId:{value:"triggerId",label:"device id",hasValue:!1},entity:{value:"entity",label:"entity",hasValue:!1},entityId:{value:"triggerId",label:"entity id",hasValue:!1},entityState:{value:"entityState",label:"entity state",hasValue:!1},eventData:{value:"eventData",label:"event data",hasValue:!1},headers:{value:"headers",label:"headers",hasValue:!1},params:{value:"params",label:"params",hasValue:!1},prevEntity:{value:"prevEntity",label:"previous entity",hasValue:!1},results:{value:"results",label:"results",hasValue:!1},receivedData:{value:"data",label:"received data",hasValue:!1},sentData:{value:"data",label:"sent data",hasValue:!1},tagId:{value:"triggerId",label:"tag id",hasValue:!1},timeSinceChangedMs:{value:"timeSinceChangedMs",label:"timeSinceChangedMs",hasValue:!1},triggerId:{value:"triggerId",label:"trigger id",hasValue:!1}},z=[N.config,"flow","global","str","num","bool","date","jsonata"];function F(t=[],{element:a="#custom-outputs",extraTypes:n=[]}={}){A=$(a),V=n,A.editableList({addButton:!0,removable:!0,sortable:!0,height:"auto",header:$("<div>").append(e("home-assistant.label.output_properties")),addItem:function(e,t,a){e.css({overflow:"hidden",whiteSpace:"nowrap"});const n=$("<div />").appendTo(e),i=$("<input/>",{class:"property-name",type:"text"}).css("width","30%").appendTo(n).typedInput({types:["msg","flow","global"]});$("<div/>",{style:"display:inline-block; padding:0px 6px;"}).text("=").appendTo(n);const o=$("<input/>",{class:"property-value",type:"text"}).css("width","calc(70% - 30px)").appendTo(n).typedInput({default:"str",types:H()});a.property&&i.typedInput("value",a.property),a.propertyType&&i.typedInput("type",a.propertyType),a.value&&o.typedInput("value",a.value),a.valueType&&o.typedInput("type",a.valueType)}}),A.editableList("addItems",t)}function H(){let e=V.reduce(((e,t)=>t in N?[...e,N[t]]:e),[]);if(e=[...e,...z],V.includes("msg")){const t=e.indexOf("flow");e.splice(t,0,"msg")}return e}function B(){const e=$(P).editableList("items"),t=[];return e.each((function(){const e=$(this).find(".property-name"),a=$(this).find(".property-value"),n=e.typedInput("value"),i=e.typedInput("type"),o=a.typedInput("value"),s=a.typedInput("type");t.push({property:n,propertyType:i,value:o,valueType:s})})),t}function q(e){return void 0===e||Array.isArray(e)&&!e.some((e=>0===e.property.length))}var U={alphaWarning:e=>$.parseHTML(`\n            <div class="ui-state-error ha-alpha-box">\n                Alpha version: At this point anything could change or not work.\n                <br />\n                Found an issue? Post it in\n                <a\n                    href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/issues"\n                    target="_blank"\n                    rel="noreferrer"\n                >\n                    issues\n                </a>\n                . Have questions or comments? Post them\n                <a\n                    href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/discussions/${e}"\n                    target="_blank"\n                    rel="noreferrer"\n                >\n                    here\n                </a>\n                .\n            </div>\n        `),betaWarning:e=>$.parseHTML(`\n            <div class="ui-state-error ha-beta-box">\n                Beta version: Config should be stable and hopefully not too many bugs.\n                <br />\n                Found an issue? Post it in\n                <a\n                    href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/issues"\n                    target="_blank"\n                    rel="noreferrer"\n                >\n                    issues\n                </a>\n                . Have questions or comments? Post them\n                <a\n                    href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/discussions/${e}"\n                    target="_blank"\n                    rel="noreferrer"\n                >\n                    here\n                </a>\n                .\n            </div>\n        `),labelStyle:function(){const e=[];return S(this)||e.push("ha-node-label-legacy"),this.name&&e.push("node_label_italic"),e.join(" ")},nodeColors:{action:"#46B1EF",alpha:"#E78BB9",api:"#7CDFFD",beta:"#77DD77",data:"#5BCBF7",event:"#399CDF",haBlue:"#41BDF5"},setup:()=>{$("#dialog-form, #node-config-dialog-edit-form").addClass("home-assistant")}};let M,W,J,G=!1;function Z(e,t,a){M=$(t),J=e,J.server||function(){let e;RED.nodes.eachConfig((t=>("server"!==t.type||e||(e=t.id),!0))),e&&M.val(e)}(),W=M.val(),setTimeout((()=>{M.on("change",(()=>{W=M.val(),null==a||a()}))}),500)}function K(e,t){let a=M.val();(J.server||a&&"_ADD_"!==a)&&(W=J.server||a,Q(e,t)),M.on("change",(()=>{W=M.val(),W!==a&&(a=W,Q(e,t))}))}function Q(e,t){"_ADD_"!==W&&$.getJSON(`homeassistant/${e}/${W}`).done((e=>{t(e)})).fail((e=>{503===e.status&&!1===G&&(G=!0,RED.notify(J._("config-server.errors.server_deploy")),setTimeout((()=>G=!1),2e3))}))}function X(e,t,{params:a={}}){let n=`homeassistant/${t}/${M.val()}`;$.isEmptyObject(a)||(n+=`?${$.param(a)}`),$.getJSON(n).done((t=>{e(t)}))}function Y(e,t={}){let a=`homeassistant/${e}/${M.val()}`;return $.isEmptyObject(t)||(a+=`?${$.param(t)}`),new Promise(((e,t)=>{$.getJSON(a).done((t=>e(t))).fail((e=>t(e)))}))}const ee=t=>function(t,a){const n=c(t);if(a&&(null==n?void 0:n.length)){const e=n.find((e=>e.area_id===a));if(e)return e.name}return e("ha-device.ui.no_area")}(W,t),te=()=>Object.values(function(e){var t;return null!==(t=r[e])&&void 0!==t?t:{}}(W)),ae=()=>function(e){var t;return null!==(t=l[e])&&void 0!==t?t:{}}(W),ne=()=>function(e){var t;return null!==(t=p[e])&&void 0!==t?t:{areas:{},devices:{}}}(W),ie={category:"home_assistant",color:U.nodeColors.haBlue,inputs:1,outputs:1,icon:"font-awesome/fa-paper-plane-o",paletteLabel:"API",label:function(){return this.name||"API"},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("haApiVersion",0)},debugenabled:{value:!1},protocol:{value:"websocket"},method:{value:"get"},path:{value:""},data:{value:""},dataType:{value:"jsonata"},responseType:{value:"json"},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"results"}],validate:q},location:{value:void 0},locationType:{value:void 0}},oneditprepare:function(){U.setup(),Z(this,"#node-input-server"),$("#node-input-data").typedInput({types:["json","jsonata"],typeField:"#node-input-dataType"}),$("#node-input-protocol").on("change",(function(){const e="http"===$(this).val();$(".http").toggle(e),$("#node-input-method").trigger("change")})).trigger("change"),$("#node-input-method").on("change",(function(){const e="http"===$("#node-input-protocol").val()&&"get"===$("#node-input-method").val()?"Params":"Data";$("#data-label").text(e)})),$("#node-input-location").typedInput({types:["msg","flow","global",{value:"none",label:"None",hasValue:!1}],typeField:"#node-input-locationType"}),F(this.outputProperties,{extraTypes:["results"]})},oneditsave:function(){this.outputProperties=B()}},oe={category:"home_assistant_entities",color:U.nodeColors.haBlue,inputs:0,outputs:1,icon:"font-awesome/fa-hand-o-up",align:"left",paletteLabel:"button",label:function(){return this.name||"button"},labelStyle:U.labelStyle,defaults:{name:{value:""},version:{value:RED.settings.get("haButtonVersion",0)},debugenabled:{value:!1},outputs:{value:1},entityConfig:{value:"",type:"ha-entity-config",filter:e=>"button"===e.entityType,required:!0},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"entityState"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"},{property:"data",propertyType:"msg",value:"",valueType:"entity"}],validate:q}},oneditprepare:function(){U.setup(),w(this),F(this.outputProperties,{extraTypes:["entity","entityState","entityId"]})},oneditsave:function(){this.outputProperties=B()}};function se(e){return/{{(?:(?!}}).+)}}/g.test(e)}function re(e){return/^\$\{[a-zA-Z_][a-zA-Z0-9_]*\}$/.test(e)}const le={theme:"nodered",templateResult:e=>$(`<div>${e.text}${e.title?`<p class="sublabel">${e.title}</p>`:""}</div>`),matcher:(e,t)=>{var a,n;if(null==e.term||""===e.term.trim())return t;const i=e.term.toLowerCase();return void 0===t.text?null:(null===(a=t.text)||void 0===a?void 0:a.toLowerCase().indexOf(i))>-1||(null===(n=null==t?void 0:t.title)||void 0===n?void 0:n.toLowerCase().indexOf(i))>-1?t:null}},pe=({multiple:e=!1,tags:t=!1,customTags:a=[],data:n})=>{const i=Object.assign(Object.assign({},le),{data:n,multiple:e,dropdownAutoWidth:!0});return t&&(i.tags=!0,i.createTag=e=>{if(e.term.endsWith("#")){const t=e.term.substring(0,e.term.length-1);return{id:t,text:t}}if(se(e.term)||re(e.term)||a.includes(e.term))return{id:e.term,text:e.term}}),i},ue=(e,t,a)=>(Array.isArray(e)?e:[e]).reduce(((e,n)=>(((null==a?void 0:a.includeUnknownIds)&&n||se(n)||re(n))&&!t.find((e=>(e=>(null==a?void 0:a.property)?e[null==a?void 0:a.property]:e)(e)===n))&&e.push({id:n,text:n,selected:!0}),e)),[]),de=e=>(n(e)?e:$(e)).hasClass("select2-hidden-accessible"),ce=()=>{const e=$("#node-input-domain").val(),t=$("#node-input-service").val();return[null==e?void 0:e.toLowerCase(),null==t?void 0:t.toLowerCase()]},ve=()=>{var e;const t=$("#service-data-desc"),a=$(".service-description",t),n=$("tbody",t),i=$(".unknown-service",t),o=$(".known-service",t),s=$("#example-data"),[r,l]=ce(),p=ae(),u=null===(e=null==p?void 0:p[r])||void 0===e?void 0:e[l];if(u){const e=u.description?u.description:"No description provided by home assistant",t=u.fields,p=Object.keys(t).reduce(((e,a)=>{var n,i;const o=t[a];return o.description||o.example?(e.push(`<tr><td><code>${a}</code></td><td>${null!==(n=t[a].description)&&void 0!==n?n:""}</td><td>${null!==(i=t[a].example)&&void 0!==i?i:""}</td></tr>`),e):e}),[]);a.html(e),$("#service-data-desc .title").html(`${r}.${l}`),p.length?($("#service-data-table").show(),s.show(),n.html(p.length>0?p.join(""):"")):($("#service-data-table").hide(),s.hide(),a.append("<p>No fields documented by Home Assistant<p>")),i.hide(),o.show()}else i.show(),o.hide(),s.hide(),$("#service-data-desc .title").val("")},ye=()=>{var e;const t=$("#node-input-entityId"),a=$("#node-input-data"),[n,i]=ce(),o=$("#node-input-server").val();if(n&&i&&o){const o=ae(),s=null===(e=null==o?void 0:o[n])||void 0===e?void 0:e[i];if(s){const e=s.fields,n=Object.keys(e).reduce(((a,n)=>{const i=e[n].example;if("entity_id"===n)return(null==i?void 0:i.toString())&&t.val(),a;if(void 0===i)return a;if("string"==typeof i)if("["===i[0]&&"]"===i[i.length-1])try{a[n]=JSON.parse(i)}catch(e){}else'"'===i[0]&&'"'===i[i.length-1]?a[n]=i.substring(1,i.length-1):a[n]=i;else"number"!=typeof i||isNaN(i)?i&&(a[n]=i):a[n]=Number(i);return a}),{});Object.keys(n).length&&a.typedInput("value",JSON.stringify(n))}}},he="#node-input-areaId",ge="#node-input-deviceId",fe="#node-input-entityId",me="none",be="all",$e="entity_only",_e=({selectedIds:e,filter:t})=>{const a=$(he),n=c(W),o=null!=e?e:a.val();a.empty();const s=(t?n.filter(t):n).map((e=>({id:e.area_id,text:e.name,selected:o.includes(e.area_id)}))).sort(h(["text"])).concat(ue(o,n,{property:"area_id",includeUnknownIds:!0}));a.select2(pe({data:s,multiple:!0,tags:!0})).maximizeSelect2Height(),i(a)},Te=({selectedIds:e,filter:t})=>{const a=$(ge),n=v(W),o=null!=e?e:a.val();a.empty();const s=(t?n.filter(t):n).map((e=>{var t;return{id:e.id,text:null!==(t=e.name_by_user)&&void 0!==t?t:e.name,selected:o.includes(e.id),title:ee(e.area_id)}})).sort(h(["text"])).concat(ue(o,n,{property:"id",includeUnknownIds:!0}));a.select2(pe({data:s,multiple:!0,tags:!0})).maximizeSelect2Height(),i(a)},we=()=>{var e,t,a,n,i;const o=ae(),[s,r]=ce();return 0!==Object.keys(o).length&&(null===(e=null==o?void 0:o[s])||void 0===e?void 0:e[r])&&void 0===(null===(a=null===(t=null==o?void 0:o[s])||void 0===t?void 0:t[r])||void 0===a?void 0:a.target)?void 0!==(null===(i=null===(n=o[s])||void 0===n?void 0:n[r])||void 0===i?void 0:i.fields.entity_id)?$e:me:be},Ie=()=>{var e,t,a,n;const i=ae(),[o,s]=ce(),r=null===(n=null===(a=null===(t=null===(e=null==i?void 0:i[o])||void 0===e?void 0:e[s])||void 0===t?void 0:t.target)||void 0===a?void 0:a.entity)||void 0===n?void 0:n.domain;return r?e=>e.entity_id.startsWith(`${r}.`):void 0},je=(e,t)=>{var a,n,i,o;const s=ne()[e],r=ae(),[l,p]=ce(),u=null===(o=null===(i=null===(n=null===(a=null==r?void 0:r[l])||void 0===a?void 0:a[p])||void 0===n?void 0:n.target)||void 0===i?void 0:i.entity)||void 0===o?void 0:o.domain;return u?e=>{var a;return null===(a=s[e[t]])||void 0===a?void 0:a.includes(u)}:void 0},xe=()=>{const e=we(),t=$(`${he}, ${ge}, ${fe}`);e===me?t.parent().hide():e===$e?(t.parent().hide(),$(fe).parent().show()):t.parent().show()},Oe=({areaId:e,deviceId:t,entityId:a}={})=>{const n=we();n===be||n===$e?(n===be?(_e({selectedIds:e,filter:je("areas","area_id")}),Te({selectedIds:t,filter:je("devices","id")})):$(`${he}, ${ge}`).val(null).trigger("change"),(({selectedIds:e,filter:t})=>{const a=$(fe),n=Object.values(te()),o=null!=e?e:a.val();a.empty();const s=(t?n.filter(t):n).map((e=>{var t;return{id:e.entity_id,text:null!==(t=e.attributes.friendly_name)&&void 0!==t?t:e.entity_id,selected:o.includes(e.entity_id),title:e.entity_id}})).sort(h(["text"])).concat(ue(o,n,{property:"entity_id",includeUnknownIds:!0}));a.select2(pe({data:s,multiple:!0,tags:!0,customTags:["all"]})).maximizeSelect2Height(),i(a)})({selectedIds:a,filter:Ie()})):$(`${he}, ${ge}, ${fe}`).val(null).trigger("change")},ke={category:"home_assistant",color:U.nodeColors.haBlue,inputs:1,outputs:1,icon:"ha-call-service.svg",align:"right",paletteLabel:"call service",label:function(){return this.name||(this.domain||this.service?`${this.domain||"<domain>"}.${this.service||"<service>"}`:"call service")},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("apiCallServiceVersion",0)},debugenabled:{value:!1},domain:{value:""},service:{value:""},areaId:{value:[]},deviceId:{value:[]},entityId:{value:[]},data:{value:""},dataType:{value:"jsonata"},mergeContext:{value:""},mustacheAltTags:{value:!1},outputProperties:{value:[],validate:q},queue:{value:"none"},target:{value:void 0},output_location:{value:void 0},output_location_type:{value:void 0},service_domain:{value:void 0},mergecontext:{value:void 0}},oneditprepare:function(){U.setup(),Z(this,"#node-input-server");const e=$("#node-input-domain"),t=$("#node-input-service"),a=$("#node-input-data"),n=$("#node-input-dataType"),i=$("#example-data"),o=a=>{var n;const i=ae(),o=null===(n=e.val())||void 0===n?void 0:n.toLowerCase(),s=!(null==i?void 0:i[o])||se(o)?Array.from(new Set(Object.values(i).map((e=>Object.keys(e))).flat())):Object.keys(i[o]),r=s.map((e=>({id:e,text:e,selected:e===a}))).sort(h(["text"])).concat(ue(a,s,{includeUnknownIds:!0}));t.empty().select2(pe({data:r,tags:!0})).maximizeSelect2Height(),a||t.val(null).trigger("change")};e.on("select2:select",(()=>{o(),Oe(),xe(),ve()})),t.on("select2:select",(()=>{Oe(),xe(),ve()})),$("#node-input-server").on("change",(()=>{(t=>{const a=ae(),n=null!=t?t:e.val(),i=Object.keys(a).map((e=>({id:e,text:e,selected:e===n}))).sort(h(["text"])).concat(ue(n,Object.keys(a),{includeUnknownIds:!0}));e.empty().select2(pe({tags:!0,data:i})).maximizeSelect2Height(),n||e.val(null).trigger("change")})(this.domain),o(this.service),Oe({entityId:this.entityId,areaId:this.areaId,deviceId:this.deviceId}),xe(),ve()})),i.on("click",ye),a.typedInput({default:"jsonata",types:["jsonata","json"],typeField:"#node-input-dataType"}),a.on("change",(()=>{0===a.val().length&&a.next().removeClass("input-error"),$("#mustacheAltTags").toggle("json"===n.val())})),F(this.outputProperties,{extraTypes:["sentData","msg"]})},oneditsave:function(){this.outputProperties=B()}},De={category:"config",defaults:{name:{value:"Home Assistant",required:!1},version:{value:RED.settings.get("serverVersion",0)},addon:{value:!1},rejectUnauthorizedCerts:{value:!0},ha_boolean:{value:"y|yes|true|on|home|open"},connectionDelay:{value:!0},cacheJson:{value:!0},heartbeat:{value:!1},heartbeatInterval:{value:30,validate:function(e){return!$("#node-config-input-heartbeat").is(":checked")||RED.validators.number()(e)&&Number(e)>=10}}},credentials:{host:{type:"text"},access_token:{type:"text"}},icon:"font-awesome/fa-home",label:function(){return this.name||"Home Assistant"},oneditprepare:function(){U.setup();const e=$("#node-config-input-addon"),t=$("#node-config-input-host");!1===this.rejectUnauthorizedCerts&&$("#accept_unauthorized_certs").prop("checked",!0);function a(){$("#server-info").toggle(!e.prop("checked")),$(".addon").toggle(e.prop("checked"))}["http://hassio/homeassistant","http://supervisor/core"].includes(t.val())&&e.prop("checked",!0),a(),e.on("click",(function(){a()}));try{t.autocomplete("destroy")}catch(e){}const n=$("#discoverInstances");n.on("click",(function(){if($(this).hasClass("disabled"))return;const e=$("i",this).removeClass("fa-search").addClass("spinner");n.addClass("disabled"),t.autocomplete({source:(e,t)=>{$.ajax({dataType:"json",url:"/homeassistant/discover",cache:!1}).done((e=>{t(e)}))},minLength:0,response:()=>{e.addClass("fa-search").removeClass("spinner"),n.removeClass("disabled")},close:()=>t.autocomplete("destroy")}).autocomplete("search","")})),$("#node-config-input-heartbeat").on("change",(function(){$("#heartbeatIntervalRow").toggle(this.checked)}))},oneditsave:function(){const e=$("#node-config-input-addon").is(":checked"),t=$("#node-config-input-host").val();if(e)this.addon=!0,this.rejectUnauthorizedCerts=!0;else{const e=document.createElement("a");e.href=t,t!==e.origin&&RED.notify("Invalid format of Base URL: "+t),this.rejectUnauthorizedCerts=!$("#accept_unauthorized_certs").prop("checked"),this.connectionDelay=!1}}},Ee={serverId:"#node-input-server",type:"entities"};function Le({root:e,options:t}){const i=n(e)?e:$(e),o=Object.assign(Object.assign({},Ee),t),s=$(o.serverId).val(),l=o.type;i.autocomplete({source:(e,t)=>{const n=e.term.toLowerCase(),i=function(e,t){let n=[];switch(t){case"entities":{if(!(e in r))return[];const t="attributes.friendly_name";n=Object.values(r[e]).map((e=>({value:e.entity_id,label:a(t,e)||e.entity_id}))).sort(d);break}case"properties":if(!(e in r))return[];n=Object.values(r[e]).map((e=>({value:e.entity_id,label:e.state}))).sort(d);break;case"trackers":{if(!(e in r))return[];const t="attributes.friendly_name";n=Object.values(r[e]).filter((e=>e.entity_id.startsWith("person.")||e.entity_id.startsWith("device_tracker."))).map((e=>({value:e.entity_id,label:a(t,e)||e.entity_id}))).sort(d);break}case"zones":{if(!(e in r))return[];const t="attributes.friendly_name";n=Object.values(r[e]).filter((e=>e.entity_id.startsWith("zone."))).map((e=>({value:e.entity_id,label:a(t,e)||e.entity_id}))).sort(d);break}}return n}(s,l).filter((e=>e.value.toLowerCase().includes(n)||e.label.toLowerCase().includes(n)));t(i)},minLength:0}).autocomplete("instance")._renderItem=(e,t)=>$("<li>").append(`<div>${t.label}<p class="sublabel">${t.value}</p></div>`).appendTo(e)}const Se=function(e,t,a){const n=$(e),i=$(t),o={value:"entity",label:"entity."},s=["str","num","bool","re","jsonata","msg","flow","global",o];"currentState"!==a&&s.splice(5,1),n.after(' <a id="clearIfState" class="editor-button"><i class="fa fa-remove"></i></a>');const r=$("#clearIfState");n.typedInput({default:"str",types:s,typeField:"#node-input-halt_if_type"}),i.on("change",(function(){const e=$(this);let t=s,a=["flow","global",o];switch(s.includes("msg")&&(a=["msg",...a]),e.val()){case"is":case"is_not":break;case"lt":case"lte":case"gt":case"gte":t=["num","jsonata",...a];break;case"includes":case"does_not_include":t=["str","jsonata",...a];break;case"jsonata":t=["jsonata"]}n.typedInput("types",t)})),i.trigger("change"),n.on("change",(function(){$(this).val()&&r.show()})),r.on("click",(e=>{n.typedInput("type","str"),n.typedInput("value",""),$(e.currentTarget).hide()})),n.val()||r.hide()},Ce={category:"home_assistant",color:U.nodeColors.haBlue,inputs:1,outputs:1,outputLabels:function(e){if(this.halt_if){if(0===e)return"'If State' is true";if(1===e)return"'If State' is false"}},icon:"ha-current-state.svg",paletteLabel:"current state",label:function(){return this.name||`current_state: ${this.entity_id}`},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("apiCurrentStateVersion",0)},outputs:{value:1},halt_if:{value:""},halt_if_type:{value:"str"},halt_if_compare:{value:"is"},entity_id:{value:""},state_type:{value:"str"},blockInputOverrides:{value:!1},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"entityState"},{property:"data",propertyType:"msg",value:"",valueType:"entity"}],validate:q},for:{value:"0"},forType:{value:"num"},forUnits:{value:"minutes"},override_topic:{value:!1},state_location:{value:"payload"},override_payload:{value:"msg"},entity_location:{value:"data"},override_data:{value:"msg"}},oneditprepare:function(){U.setup(),Z(this,"#node-input-server"),Le({root:"#node-input-entity_id"}),Se("#node-input-halt_if","#node-input-halt_if_compare","currentState"),$("#node-input-halt_if_compare").on("change",(function(){const e=["is","is_not","includes","does_not_include"].includes(this.value);$("#for-row").toggle(e)})),$("#node-input-for").typedInput({default:"num",types:["num","jsonata","msg","flow","global"],typeField:"#node-input-forType"}),F(this.outputProperties,{extraTypes:["entity","entityId","entityState"]})},oneditsave:function(){const e=$("#node-input-halt_if").val()?2:1;$("#node-input-outputs").val(e),this.outputProperties=B()}};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function Re(e,t,a,n){return new(a||(a=Promise))((function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function r(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,r)}l((n=n.apply(e,t||[])).next())}))}function Pe(e,t,a,n){if("a"===a&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===a?n:"a"===a?n.call(e):n?n.value:t.get(e)}function Ae(e,t,a,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,a):i?i.value=a:t.set(e,a),a}var Ve=Object.freeze({__proto__:null,inputCount:1,getCapabilitiesList:e=>Re(void 0,void 0,void 0,(function*(){return yield Y("deviceActionCapabilities",{action:e})})),getEventList:e=>Re(void 0,void 0,void 0,(function*(){return yield Y("deviceActions",{deviceId:e})})),setDefaultOutputs:()=>[]});var Ne=Object.freeze({__proto__:null,inputCount:0,getCapabilitiesList:e=>Re(void 0,void 0,void 0,(function*(){return yield Y("deviceTriggerCapabilities",{trigger:e})})),getEventList:e=>Re(void 0,void 0,void 0,(function*(){return yield Y("deviceTriggers",{deviceId:e})})),setDefaultOutputs:e=>e});function ze(t=[],a=[]){const n=[];return t.forEach((t=>{const i=a.find((e=>e.name===t.name));switch(t.type){case"boolean":{const e=function(e,t){const a=`deviceExtra-${e.name}`,n=t?t.value:"";return Fe(`\n        <label for="${a}">${e.name}</label>\n        <input type="checkbox" id="${a}" style="width: auto" value="${n}"/>        \n        `)}(t,i);n.push($(e));break}case"float":{const e=function(e,t){const a=`deviceExtra-${e.name}`,n=t?t.value:"";let i=`\n        <label for="${a}">${e.name}</label>\n        <input type="text" id="${a}" style="width: 35%" value="${n}"/>        \n        `;e.description&&e.description.suffix&&(i+=`<span>${e.description.suffix}</span>`);return Fe(i)}(t,i);n.push($(e));break}case"integer":{const e=function(e,t){var a;const n=`deviceExtra-${e.name}`,i=t?t.value:"",o=$(`\n        <label for="${n}">${e.name}</label>\n        <div class="range-row">\n            <input type="checkbox" />\n            <input type="range" id="${n}" max="${e.valueMax}" min="${null!==(a=e.valueMin)&&void 0!==a?a:0}" value="${i}" />\n            <input type="text" value="${i}" />\n        </div>\n        `),s=o.find('input[type="checkbox"]'),r=o.find('input[type="range"]'),l=o.find('input[type="text"]');!1!==e.optional&&void 0===(null==t?void 0:t.value)||s.prop("checked",!0);!1===e.optional&&s.hide();return s.on("change",(()=>{r.prop("disabled",!s.prop("checked")).trigger("change"),l.prop("disabled",!s.prop("checked"))})).trigger("change"),r.on("change input",(()=>{l.val(r.val())})).trigger("change"),l.on("keyup change",(()=>{const t=l.val();if(t.length>0){const a=Number(t);a<e.valueMin&&l.val(e.valueMin),a>e.valueMax&&l.val(e.valueMax),r.val(l.val())}})),Fe(o)}(t,i);n.push(e);break}case"positive_time_period_dict":{const a=function(t,a){const n=`deviceExtra-${t.name}`,i=a?a.value:"",o=e=>a&&e===a.unit?"selected":"",s="ha-device.label",r={seconds:e(`${s}.seconds`),minutes:e(`${s}.minutes`),hours:e(`${s}.hours`)};return Fe(`\n        <label for="${n}">\n            <i class="fa fa-clock-o"></i> ${t.name}\n        </label>\n        <input type="text" id="${n}" style="width: 35%" value="${i}"/>\n        <select id="${n}Units" style="width: 35%">\n            <option value="seconds" ${o("seconds")}>${r.seconds}</option>\n            <option value="minutes" ${o("minutes")}>${r.minutes}</option>\n            <option value="hours" ${o("hours")}>${r.hours}</option>\n        </select>`)}(t,i);n.push($(a));break}case"select":{const e=function(e,t={}){const a=`deviceExtra-${e.name}`,n=e.options.reduce(((e,[a,n])=>{const i=t.value===a?"selected":"";return e.push(`<option value="${a}" ${i}>${n}</option>`),e}),[]);return Fe(`\n        <label for="${a}">${e.name}</label>\n        <select id="${a}" style="width: 70%">\n        ${n.join("")}\n        </select>        \n        `)}(t,i);n.push($(e));break}case"string":{const e=function(e,t){const a=`deviceExtra-${e.name}`,n=t?t.value:"";return Fe(`\n        <label for="${a}">${e.name}</label>\n        <input type="text" id="${a}" style="width: 70%" value="${n}"/>\n        `)}(t,i);n.push($(e));break}default:{const a=function(t,a={}){return Fe(`<label class="error"><i class="fa fa-exclamation-triangle"></i> Error</label>${t} -- <a href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/issues/new?title=[Device Node] Unknown extra type: ${a.type}" target="_blank"> ${e("ha-device.error.report")}</a>`)}(e("ha-device.error.unknown_field_type",{type:t.type}),{type:t.type});n.push($(a))}}})),n}function Fe(e,t=["deviceExtra"]){return e instanceof $?$(`<div class="form-row ${t.join(" ")}"></div>`).append(e):`<div class="form-row ${t.join(" ")}">${e}</div>`}const He=e=>"action"===e?Ve:Ne,Be=[{property:"payload",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],qe={category:"home_assistant",color:U.nodeColors.alpha,inputs:0,outputs:1,icon:"font-awesome/fa-cube",paletteLabel:"device",label:function(){return this.name||`device ${this.deviceType}`},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("haDeviceVersion",0)},debugenabled:{value:!1},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},inputs:{value:0},deviceType:{value:"trigger"},device:{value:""},event:{value:void 0,validate:e=>void 0!==e},capabilities:{value:[],validate:e=>{if(!Array.isArray(e))return!0;for(const t of e)switch(t.type){case"float":if(!Number.isFinite(Number(t.value)))return!1;break;case"positive_time_period_dict":if(-1===Math.sign(t.value))return!1;break}return!0}},outputProperties:{value:Be,validate:q}},oneditprepare:function(){U.setup(),Z(this,"#node-input-server"),w(this);const n="_ADD_",i=$("#node-input-server"),o=$("#node-input-deviceType"),s=$("#node-input-device"),l=$("#event");let p,u=He(o.val());s.on("select2:select",(function(){I($(this).val())})),l.on("change",(function(e){const t=e.target.value;if("__NONE__"===t)return;const a=l.data("events");j(a[t])}));const d=(e,t)=>{const n=a("text",e),i=a("text",t);return n===i?0:"string"!=typeof n?1:n.localeCompare(i)},y=()=>{_(),T()},h=()=>Re(this,void 0,void 0,(function*(){const e=RED.i18n.lang();try{p=yield Y("translations",{cat:"device_automation",lang:e})}catch(e){RED.notify("Error retrieving translations.","error")}})),g=(t,a)=>{if(a&&(null==t?void 0:t.length)){const e=t.find((e=>e.area_id===a));if(e)return e.name}return e("ha-device.ui.no_area")},f=e=>{const t=i.val();if(t===n)return;const a=v(t);if(!a)return;const o=c(t);s.empty(),s.select2(Object.assign(Object.assign({},le),{data:a.map((t=>({id:t.id,text:t.name_by_user||t.name,selected:t.id===e,title:g(o,t.area_id)}))).sort(d)})).maximizeSelect2Height()},m=()=>Re(this,void 0,void 0,(function*(){y(),i.val()!==n&&(h(),f(),I(s.val()))})),b=e=>{const t=s.val(),a=e.target.value;var n;T(),t&&(u=He(a),I(t)),n=O(a),V=n;const i="trigger"===a?Be:[],o=u.setDefaultOutputs(i);var r;r=o,A.editableList("empty"),A.editableList("addItems",r),$("#event").prev().text(a),$("#haConfigRow").toggle("trigger"===a)};i.one("change",(()=>{y(),f(this.device),i.val()!==n&&(h(),I(this.device,this.event,this.capabilities)),setTimeout((()=>{i.on("change",m),o.on("change",b)}),100)}));const _=()=>{l.html(`<option value="__NONE__">No ${o.val()}s</option>`).trigger("change").prop("disabled",!0)},T=()=>{$(".deviceExtra").remove()},I=(e,a,n)=>Re(this,void 0,void 0,(function*(){if(!e)return;const i=yield u.getEventList(e);let r;if(0===i.length)_(),T(),r=0;else{if(i[0].device_id!==s.val())return;const e=o.val();l.data("events",i).empty().prop("disabled",!1);const p=[];for(let t=0;t<i.length;t++){const a=yield x(e,i[t]);p.push(new Option(a,t.toString()))}l.append(p),r=i.findIndex((e=>t(a,e))),r=-1===r?0:r,j(i[r],n)}$("option",l).eq(r).prop("selected",!0)})),j=(e,t)=>Re(this,void 0,void 0,(function*(){T();const a=yield u.getCapabilitiesList(e);if(null==a?void 0:a.length){l.data("capabilities",a);const e=ze(a,t);l.parent().after(e)}})),x=(e,t)=>Re(this,void 0,void 0,(function*(){var a;const n=(a="type")=>`component.${t.domain}.device_automation.${e}_${a}.${t[a]}`;let o=null!==(a=null==p?void 0:p[n()])&&void 0!==a?a:t.subtype?`"${t.subtype}" ${t.type}`:t.type;const s={entity_name:()=>Re(this,void 0,void 0,(function*(){if(!t.entity_id)return"<unknown>";const e=function(e,t){return r[e][t]}(i.val(),t.entity_id);return e?e.attributes&&void 0!==e.attributes.friendly_name?e.attributes.friendly_name||"":t.entity_id.split(".")[1].replace(/_/g," "):""})),subtype:()=>p[n("subtype")]||t.subtype},l=Object.keys(s);for(const e of l){const t=`{${e}}`;if(-1!==o.indexOf(t)){const a=yield s[e]();o=o.replace(t,a)}}return o})),O=e=>({action:["sentData"],trigger:["eventData","deviceId"]}[e]);$("#dialog-form").prepend(U.alphaWarning(367)),F(this.outputProperties,{extraTypes:O(o.val())}),$("#haConfigRow").toggle("trigger"===o.val()),$("#exposeToHa").remove()},oneditsave:function(){const e=He($("#node-input-deviceType").val()),t=$("#event"),a=t.val();if(this.inputs=e.inputCount,"__NONE__"!==a){const e=t.data("events"),n=t.data("capabilities");this.event=e[a],this.capabilities=function(e=[]){return e.reduce(((e,t)=>{const a=`deviceExtra-${t.name}`,n=$(`#${a}`).val();switch(t.type){case"boolean":e.push({name:t.name,type:t.type,value:$(`#${a}`).is(":checked")});break;case"float":case"positive_time_period_dict":if(n&&n.length&&!isNaN(Number(n))){const i={name:t.name,type:t.type,value:Number(n),unit:"positive_time_period_dict"===t.type?$(`#${a}Units`).val():void 0};e.push(i)}break;case"integer":if($(`#${a}`).siblings('input[type="checkbox"]').prop("checked")&&n&&n.length&&!isNaN(Number(n))){const a={name:t.name,type:t.type,value:Number(n)};e.push(a)}break;case"select":n&&n.length&&e.push({name:t.name,type:t.type,value:n});break;case"string":n.length&&e.push({name:t.name,type:t.type,value:n})}return e}),[])}(n)}this.haConfig=I(),this.outputProperties=B()}},Ue={binary_sensor:["msg","flow","global","jsonata","str","num","bool"],sensor:["msg","flow","global","jsonata","str","num","bool","date"],switch:["msg"]},Me={binary_sensor:["name","device_class","icon","unit_of_measurement"],sensor:["name","device_class","icon","unit_of_measurement","state_class","last_reset"],switch:["name","icon"]},We=["str","num","bool","date","jsonata","msg","flow","global"],Je={binary_sensor:["state","attributes","output-location","input-override","resend","debug"],sensor:["state","attributes","output-location","input-override","resend","debug"],switch:["output-on-state-change","output-payload"]},Ge={category:"home_assistant",color:U.nodeColors.haBlue,inputs:1,outputs:1,icon:function(){return"switch"===(null==this?void 0:this.entityType)?"ha-entity-switch.svg":"font-awesome/fa-genderless"},align:"right",paletteLabel:"entity",label:function(){return this.name||`type: ${this.entityType}`},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("haEntityVersion",0)},debugenabled:{value:!1},outputs:{value:1},entityType:{value:"sensor"},config:{value:[{property:"name",value:""},{property:"device_class",value:""},{property:"icon",value:""},{property:"unit_of_measurement",value:""},{property:"state_class",value:""},{property:"last_reset",value:""}]},state:{value:"payload"},stateType:{value:"msg"},attributes:{value:[]},resend:{value:!0},outputLocation:{value:"payload"},outputLocationType:{value:"none"},inputOverride:{value:"allow"},outputOnStateChange:{value:null},outputPayload:{value:null},outputPayloadType:{value:null}},oneditprepare:function(){U.setup(),Z(this,"#node-input-server"),w(this);$("#node-input-state").typedInput({types:Ue[$("#node-input-entityType").val()],typeField:"#node-input-stateType",type:this.stateType}),$("#attributes").editableList({removable:!0,addButton:"add attribute",header:$("<div>").append($.parseHTML("<div style='width:40%; display: inline-grid'>Attribute Key</div><div style='display: inline-grid'>Value</div>")),addItem:function(e,t,a){const n=$("<div />").appendTo(e);$("<input />",{type:"text",name:"property",style:"width: 40%;margin-right: 5px;"}).attr("autocomplete","disable").appendTo(n).val(a.property);const i=$("<input />",{type:"text",name:"value",style:"width: 55%;"}).appendTo(n).val(a.value);i.typedInput({types:We}),i.typedInput("type",a.valueType)}}).editableList("addItems",this.attributes),$("#haConfig").editableList({addButton:!1,header:$("<div>Home Assistant Config (optional)</div>"),addItem:function(e,t,a){const n=$("<div />").appendTo(e),i=$("<label>").appendTo(n);$("<span>").text(a.property.replace(/_/g," ")).appendTo(i),$("<input />",{type:"hidden",name:"property",value:a.property}).appendTo(i),$("<input />",{type:"text",name:"value",value:a.value}).attr("autocomplete","disable").appendTo(i)}}).editableList("addItems",this.config);const e={value:"none",label:"none",hasValue:!1};$("#node-input-outputLocation").typedInput({types:["msg","flow","global",e],typeField:"#node-input-outputLocationType"}),$("#node-input-outputPayload").typedInput({types:["str","num","bool","jsonata","date",e],typeField:"#node-input-outputPayloadType"});const t=this;$("#node-input-entityType").on("change",(function(){const e=$(this).val();if($("#node-input-state").typedInput("types",Ue[e]),$("#dialog-form .form-row").each((function(){var t;const a=$(this),n=null===(t=a.attr("class"))||void 0===t?void 0:t.split(" ");if(null==n?void 0:n.includes("optional-row")){const t=a.attr("id");t&&a.toggle(Je[e].includes(t.replace(/-row$/,"")))}})),$("#haConfig").editableList("filter",(t=>Me[e].includes(t.property))),"switch"===e)t.outputs=2;else t.outputs=1,$("#node-input-outputOnStateChange").prop("checked",!1).trigger("change")})).trigger("change"),$("#node-input-outputOnStateChange").on("change",(function(){"switch"===$("#node-input-entityType").val()&&$(this).prop("checked")?$("#output-payload-row").show():$("#output-payload-row").hide()})).trigger("change")},oneditsave:function(){this.attributes=[],this.config=[];const e=this;$("#attributes").editableList("items").each((function(){const t=$(this);e.attributes.push({property:t.find("input[name=property]").val(),value:t.find("input[name=value]").typedInput("value"),valueType:t.find("input[name=value]").typedInput("type")})})),$("#haConfig").editableList("items").each((function(){const t=$(this);e.config.push({property:t.find("input[name=property]").val(),value:t.find("input[name=value]").val()})}))}},Ze={category:"config",defaults:{server:{value:"",required:!0},name:{value:""},version:{value:RED.settings.get("serverVersion",0)},haConfig:{value:[]},entityType:{value:"button",required:!0}},label:function(){return this.name||`${this.entityType} ${this.id}`},oneditprepare:function(){U.setup();const e={button:[{id:"name",type:"string"},{id:"icon",type:"string"},{id:"device_class",type:"select",values:[{value:"",text:""},{value:"restart",text:"restart"},{value:"update",text:"update"}]}],binary_sensor:[{id:"name",type:"string"},{id:"device_class",type:"string"},{id:"icon",type:"string"},{id:"unit_of_measurement",type:"string"}],sensor:[{id:"name",type:"string"},{id:"device_class",type:"string"},{id:"icon",type:"string"},{id:"unit_of_measurement",type:"string"},{id:"state_class",type:"string"},{id:"last_reset",type:"date"}],switch:[{id:"name",type:"string"},{id:"icon",type:"string"}]};RED.nodes.eachConfig((e=>("server"===e.type&&$("#node-config-input-server").append(`<option value="${e.id}" ${this.server===e.id&&"selected"}>${e.name}</option>`),!0)));const t=$("#node-config-dialog-edit-form"),a=(e,t,a)=>{const n=$("<select />",{name:"value",id:e,style:"width: 70%","data-property":a.id});return a.values.forEach((e=>{$("<option />",{value:e.value,text:e.text?this._(`ha-entity-config.label.select_option.${e.text}`):"",selected:e.value===t}).appendTo(n)})),n},n=e=>{var n,i;const o=`ha-config-${e.id}`,s=$("<div />",{class:"form-row ha-config-row","data-type":e.type}).appendTo(t);$("<label>",{for:o}).text(this._(`ha-entity-config.label.${e.id}`)).appendTo(s),s.append(" ");const r=null!==(i=null===(n=this.haConfig.find((t=>t.property===e.id)))||void 0===n?void 0:n.value)&&void 0!==i?i:"";switch(e.type){case"string":s.append(((e,t,a)=>$("<input />",{type:"text",name:"value",value:t,id:e,"data-property":a.id}).attr("autocomplete","off"))(o,r,e));break;case"select":s.append(a(o,r,e))}};$("#node-config-input-entityType").on("change",(function(){const t=$(this).val();$(".ha-config-row").remove(),e[t].forEach(n)}))},oneditsave:function(){const e=[];$(".ha-config-row").each((function(){const t=$(this);switch(t.data("type")){case"string":{const a=t.find("input").data("property"),n=t.find("input").val();e.push({property:a,value:n});break}case"select":{const a=t.find("select"),n=a.data("property"),i=a.val();e.push({property:n,value:i});break}}})),this.haConfig=e}},Ke={category:"home_assistant",color:U.nodeColors.haBlue,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("serverEventsVersion",0)},event_type:{value:"",required:!1},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},waitForRunning:{value:!0},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:'$outputData("eventData").event_type',valueType:"jsonata"}],validate:q}},inputs:0,outputs:1,icon:"ha-events-all.svg",paletteLabel:"events: all",label:function(){return this.name||`events: ${this.event_type||"all"}`},labelStyle:U.labelStyle,oneditprepare:function(){U.setup(),Z(this,"#node-input-server"),w(this),$("#node-input-event_type").on("change keyup",(function(){const e=$(this).val();$("#eventAlert").toggle(0===e.length)})),F(this.outputProperties,{extraTypes:["eventData"]})},oneditsave:function(){this.haConfig=I(),this.outputProperties=B()}};var Qe,Xe,Ye,et,tt,at;class nt{constructor({filterTypeSelector:e,entityId:t}){Qe.set(this,void 0),Xe.set(this,void 0),Ye.set(this,void 0),et.set(this,void 0),tt.set(this,void 0),at.set(this,void 0),Ae(this,Ye,$(e),"f"),Ae(this,tt,t,"f"),this.buildElements(),this.init()}get entityId(){var e,t,a,n;let i=[];switch(Pe(this,Ye,"f").val()){case"exact":i=de(Pe(this,Qe,"f"))?null===(t=null===(e=Pe(this,Qe,"f").select2("data"))||void 0===e?void 0:e[0])||void 0===t?void 0:t.id:"";break;case"list":i=de(Pe(this,Qe,"f"))?null!==(n=null===(a=Pe(this,Qe,"f").select2("data"))||void 0===a?void 0:a.map((e=>e.id)))&&void 0!==n?n:[]:"";break;case"substring":case"regex":i=Pe(this,Xe,"f").val()}return i}buildElements(){const e=Pe(this,Ye,"f").parent(),t=$("<div />",{class:"ha-entity-selector"});Ae(this,Qe,$("<select />",{id:"ha-entity-selector"}),"f"),Ae(this,Xe,$("<input />",{type:"text"}),"f"),Ae(this,et,$('\n            <a class="editor-button">\n                <i class="fa fa-search"></i>\n            </a>'),"f"),e.append(t.append([Pe(this,Qe,"f"),Pe(this,Xe,"f"),Pe(this,et,"f")])),Pe(this,Ye,"f").appendTo(t)}init(){Pe(this,Ye,"f").on("change",this.showHide.bind(this)),Pe(this,et,"f").on("click",(()=>{(({filter:e,filterType:t,entities:a,complete:n})=>{RED.editor.showTypeEditor("ha_entity_filter",{filter:e,filterType:t,entities:a,complete:n})})({filter:Pe(this,Xe,"f").val(),filterType:Pe(this,Ye,"f").val(),entities:te(),complete:e=>{Pe(this,Xe,"f").val(e)}})})),this.generateEntityList(),this.initSelect2(Array.isArray(Pe(this,tt,"f"))),Pe(this,Xe,"f").val(Pe(this,tt,"f"))}showHide(){const e=Pe(this,Ye,"f").val();switch(e){case"exact":case"list":this.initSelect2("list"===e),Pe(this,et,"f").hide(),Pe(this,Xe,"f").hide();break;case"substring":case"regex":Pe(this,Qe,"f").next().hide(),Pe(this,et,"f").show(),Pe(this,Xe,"f").val(Pe(this,tt,"f")).show()}}generateEntityList(){const e=Object.values(te()),t=Pe(this,at,"f")?Pe(this,Qe,"f").select2("data").map((e=>e.id)):Array.isArray(Pe(this,tt,"f"))?Pe(this,tt,"f"):[Pe(this,tt,"f")],a=e.map((e=>{var a;return{id:e.entity_id,text:null!==(a=e.attributes.friendly_name)&&void 0!==a?a:e.entity_id,title:e.entity_id,selected:t.includes(e.entity_id)}})).sort(h(["text"])).concat(ue(t,e,{property:"entity_id",includeUnknownIds:!0}));Ae(this,at,a,"f")}initSelect2(e=!1){Pe(this,Qe,"f").select2(pe({data:Pe(this,at,"f").filter((e=>{var t;return(null===(t=e.id)||void 0===t?void 0:t.length)>0})),tags:!0,multiple:e})).maximizeSelect2Height(),e&&i(Pe(this,Qe,"f"))}destroy(){de(Pe(this,Qe,"f"))&&Pe(this,Qe,"f").select2("destroy")}serverChanged(){Pe(this,Qe,"f").empty(),this.generateEntityList(),this.showHide()}}Qe=new WeakMap,Xe=new WeakMap,Ye=new WeakMap,et=new WeakMap,tt=new WeakMap,at=new WeakMap;const it={category:"home_assistant",color:U.nodeColors.haBlue,inputs:0,outputs:1,outputLabels:["'If State' is true","'If State' is false"],icon:"ha-events-state-changed.svg",paletteLabel:"events: state",label:function(){return this.name||`state_changed: ${this.entityidfilter||"all entities"}`},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("serverStateChangedVersion",0)},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},entityidfilter:{value:"",required:!0},entityidfiltertype:{value:"exact"},outputinitially:{value:!1},state_type:{value:"str"},haltifstate:{value:""},halt_if_type:{value:"str"},halt_if_compare:{value:"is"},outputs:{value:1},output_only_on_state_change:{value:!0},for:{value:"0"},forType:{value:"num"},forUnits:{value:"minutes"},ignorePrevStateNull:{value:!1},ignorePrevStateUnknown:{value:!1},ignorePrevStateUnavailable:{value:!1},ignoreCurrentStateUnknown:{value:!1},ignoreCurrentStateUnavailable:{value:!1},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"entityState"},{property:"data",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],validate:q}},oneditprepare:function(){U.setup();const e=$("#node-input-entityidfilter");Z(this,"#node-input-server",(()=>{t.serverChanged()})),w(this);const t=new nt({filterTypeSelector:"#node-input-entityidfiltertype",entityId:this.entityidfilter});$("#dialog-form").data("entitySelector",t);let a=[];K("entities",(t=>{a=t,e.autocomplete({source:a,minLength:0})})),Se("#node-input-haltifstate","#node-input-halt_if_compare"),$("#node-input-for").typedInput({default:"num",types:["num","jsonata","flow","global"],typeField:"#node-input-forType"}),F(this.outputProperties,{extraTypes:["eventData","entityId","entityState"]})},oneditsave:function(){const e=$("#node-input-haltifstate").val()?2:1;$("#node-input-outputs").val(e),this.haConfig=I(),this.outputProperties=B();const t=$("#dialog-form").data("entitySelector");this.entityidfilter=t.entityId,t.destroy()},oneditcancel:function(){$("#dialog-form").data("entitySelector").destroy()}},ot={category:"home_assistant",color:U.nodeColors.haBlue,inputs:1,outputs:1,icon:"ha-fire-event.svg",align:"right",paletteLabel:"fire event",label:function(){return this.name||`Event: ${this.event}`},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("haFireEventVersion",0)},event:{value:""},data:{value:""},dataType:{value:"jsonata"}},oneditprepare:function(){U.setup(),Z(this,"#node-input-server"),$("#node-input-data").typedInput({types:["json","jsonata"],typeField:"#node-input-dataType"})}},st={category:"home_assistant",color:U.nodeColors.haBlue,inputs:1,outputs:1,icon:"ha-get-entities.svg",paletteLabel:"get entities",label:function(){return this.name||"get entities"},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("haGetEntitiesVersion",0)},rules:{value:[{property:"",logic:"is",value:"",valueType:"str"}]},output_type:{value:"array"},output_empty_results:{value:!1},output_location_type:{value:"msg"},output_location:{value:"payload"},output_results_count:{value:1,validate:function(e){return"random"!==$("#node-input-output_type").val()||Number.isInteger(Number(e))}}},oneditprepare:function(){U.setup();const e=[{value:"is",text:"is"},{value:"is_not",text:"is not"},{value:"lt",text:"<"},{value:"lte",text:"<="},{value:"gt",text:">"},{value:"gte",text:">="},{value:"includes",text:"in"},{value:"does_not_include",text:"not in"},{value:"starts_with",text:"starts with"},{value:"in_group",text:"in group"},{value:"jsonata",text:"JSONata"}],t={value:"entity",label:"entity."},a=["str","num","bool","re","jsonata","msg","flow","global",t],n=$("#logic");let i=[];Z(this,"#node-input-server"),K("properties",(e=>{i=e,$(".input-property").autocomplete({source:i,minLength:0})})),n.editableList({addButton:!0,removable:!0,height:"auto",addItem:function(n,o,s){const r=$("<div />",{class:"editable-list-row"}).appendTo(n),l=$("<div />",{class:"editable-list-row"}).appendTo(n);s.hasOwnProperty("logic")||(s.logic="is"),$("<span />",{text:"Property",style:"padding-right: 47px;"}).appendTo(r);const p=$("<input />",{type:"text",class:"input-property",style:"margin-left: 5px;"}).appendTo(r).val(s.property);p.autocomplete({source:i,minLength:0});const u=$("<select/>",{style:"margin-right: 5px;width: auto;"}).appendTo(l).on("change",(function(){const e=$(this).val();let n=a;switch(p.prop("disabled","jsonata"===e),e){case"is":case"is_not":break;case"lt":case"lte":case"gt":case"gte":n=["num","jsonata","msg","flow","global",t];break;case"includes":case"does_not_include":case"starts_with":case"in_group":n=["str","jsonata","msg","flow","global",t];break;case"jsonata":n=["jsonata"]}d.typedInput("types",n)}));for(const t in e)u.append($("<option></option>").val(e[t].value).text(e[t].text));const d=$("<input />",{class:"input-value",type:"text",style:"width: 70%;"}).appendTo(l).val(s.value);d.typedInput({types:a}),d.typedInput("type",s.valueType),u.val(s.logic).trigger("change")}}),n.editableList("addItems",this.rules),$("#node-input-output_location").typedInput({types:["msg","flow","global"],typeField:"#node-input-output_location_type"}),$("#node-input-output_results_count").spinner({min:1}),$("#node-input-output_type").on("change",(function(){switch($(".output-option").hide(),$(this).val()){case"array":$("#output_empty_results").show(),$("#output_location").show();break;case"count":$("#output_location").show();break;case"random":$("#output_results_count").show(),$("#output_location").show()}})).trigger("change")},oneditsave:function(){const e=$("#logic").editableList("items");this.rules=[];const t=this;e.each((function(){var e,a,n;const i=$(this),o=null!==(e=i.find(".input-property").val())&&void 0!==e?e:"",s=null!==(a=i.find("select").val())&&void 0!==a?a:"",r=null!==(n=i.find(".input-value").typedInput("value"))&&void 0!==n?n:"",l=i.find(".input-value").typedInput("type");t.rules.push({property:o,logic:s,value:r,valueType:l})}))}},rt={category:"home_assistant",color:U.nodeColors.haBlue,inputs:1,outputs:1,icon:"ha-get-history.svg",paletteLabel:"get history",label:function(){if(this.name)return this.name;if(this.useRelativeTime&&this.relativeTime)return this.relativeTime;if(this.startdate){const e=new Date(this.startdate);return`${e.toLocaleDateString()} ${e.toLocaleTimeString()}`}return"get history"},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("apiGetHistoryVersion",0)},startdate:{value:""},enddate:{value:""},entityid:{value:""},entityidtype:{value:""},useRelativeTime:{value:!1},relativeTime:{value:""},flatten:{value:!0},output_type:{value:"array"},output_location_type:{value:"msg"},output_location:{value:"payload"}},oneditprepare:function(){U.setup(),this.entityidtype=this.entityidtype||"is",$("#node-input-entityidtype").val(this.entityidtype),Z(this,"#node-input-server"),Le({root:"#node-input-entityid"}),$("#node-input-useRelativeTime").on("change",(function(){this.checked?($(".relative_row").show(),$(".date_row").hide()):($(".relative_row").hide(),$(".date_row").show())})),$("#node-input-output_location").typedInput({types:["msg","flow","global"],typeField:"#node-input-output_location_type"}),$("#node-input-output_type").on("change",(e=>{const t=e.target;$(".output-option").toggle("array"===t.value)})).trigger("change")}},lt={category:"home_assistant",color:U.nodeColors.haBlue,inputs:0,outputs:1,outputLabels:["'If State' is true","'If State' is false"],icon:"ha-poll-state.svg",paletteLabel:"poll state",label:function(){return this.name||`poll state: ${this.entity_id}`},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("pollStateVersion",0)},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},updateinterval:{value:"60"},updateIntervalType:{value:"num"},updateIntervalUnits:{value:"seconds"},outputinitially:{value:!1},outputonchanged:{value:!1},entity_id:{value:"",required:!0},state_type:{value:"str"},halt_if:{value:""},halt_if_type:{value:"str"},halt_if_compare:{value:"is"},outputs:{value:1}},oneditprepare:function(){U.setup(),Z(this,"#node-input-server"),w(this),Le({root:"#node-input-entity_id"}),$("#node-input-updateinterval").typedInput({types:["num","jsonata"],typeField:"#node-input-updateIntervalType"}),Se("#node-input-halt_if","#node-input-halt_if_compare")},oneditsave:function(){const e=$("#node-input-halt_if").val()?2:1;$("#node-input-outputs").val(e),this.haConfig=I()}};let pt;const ut={category:"home_assistant",color:U.nodeColors.haBlue,inputs:1,outputs:1,icon:"ha-render-template.svg",paletteLabel:"render template",label:function(){return this.name||"template"},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("apiRenderTemplateVersion",0)},template:{value:""},resultsLocation:{value:"payload"},resultsLocationType:{value:"msg"},templateLocation:{value:"template"},templateLocationType:{value:"msg"}},oneditprepare:function(){U.setup(),Z(this,"#node-input-server");const e=$("#node-input-template");$("#node-input-templateLocation").typedInput({types:["msg","flow","global",{value:"none",label:"none",hasValue:!1}],typeField:"#node-input-templateLocationType"}),$("#node-input-resultsLocation").typedInput({types:["msg","flow","global",{value:"none",label:"none",hasValue:!1}],typeField:"#node-input-resultsLocationType"}),pt=RED.editor.createEditor({id:"node-input-template-editor",value:e.val()})},oneditresize:function(){var e;const t=$("#dialog-form>div:not(.node-text-editor-row)"),a=$("#dialog-form>div.node-text-editor-row"),n=$(".node-text-editor");let i=null!==(e=$("#dialog-form").height())&&void 0!==e?e:0;for(let e=0;e<t.length;e++){const a=$(t[e]).outerHeight(!0);"number"==typeof a&&(i-=a)}i-=parseInt(a.css("marginTop"))+parseInt(a.css("marginBottom")),n.css("height",`${i}px`),null==pt||pt.resize()},oneditcancel:function(){null==pt||pt.destroy(),pt=void 0},oneditsave:function(){var e;const t=null!==(e=null==pt?void 0:pt.getValue())&&void 0!==e?e:"";$("#node-input-template").val(t),null==pt||pt.destroy(),pt=void 0}},dt={category:"home_assistant",color:U.nodeColors.haBlue,outputs:1,icon:"font-awesome/fa-tag",paletteLabel:"tag",label:function(){return this.name||"tag"},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("haTagVersion",0)},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},tags:{value:[""],required:!0,validate:function(e){return!!e.length}},devices:{value:[]},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"eventData"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],validate:q}},oneditprepare:function(){U.setup(),w(this);const e="__ALL_TAGS__",t=$("#tags"),a=$("#devices");let n=[];const i=this._;t.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append(i("ha-tag.label.tags")),addItem:function(t,a,o){const s=$("<div />").appendTo(t);$("<span />",{text:i("ha-tag.label.tag"),style:"padding-right: 74px;"}).appendTo(s),((t,a)=>{const o=$("<select>",{width:"70%"}).append($("<option>").attr({value:e,selected:a===e}).text(i("ha-tag.label.all_tags"))).appendTo(t);n.forEach((e=>{$("<option>").attr({value:e.id,selected:e.id===a}).text(e.name||e.id).appendTo(o)}))})(s,o)},buttons:[{label:i("ha-tag.label.update_tag_list"),icon:"fa fa-refresh",click:()=>{X(s,"tags",{params:{update:!0}})}}]});function o(e,t){const a=e.name||e.tag_id,n=t.name||t.tag_id;return a===n?0:a.localeCompare(n)}const s=a=>{n=a.sort(o);const i=new Set;t.editableList("items").each((function(){const e=$(this).find("select").val();i.add(e)}));const s=Array.from(i).filter((t=>t===e||n.find((e=>e.id===t))));t.editableList("empty"),t.editableList("addItems",s),$("#no-tags-found").toggle(0===n.length)};Z(this,"#node-input-server"),K("tags",(e=>{n=e,t.editableList("addItems",this.tags),s(e)})),$("#update-tag-list").on("click",(()=>{X(s,"tags",{params:{update:!0}})})),a.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append(i("ha-tag.label.devices")),addItem:function(e,t,a){const n=$("<div />").appendTo(e);$("<span />",{text:i("ha-tag.label.device_id"),style:"padding-right: 35px;"}).appendTo(n);const o=$.isEmptyObject(a)?"":a;$("<input />",{type:"text",class:"input-device"}).appendTo(n).val(o)}}),a.editableList("addItems",this.devices),F(this.outputProperties,{extraTypes:["eventData","tagId"]})},oneditsave:function(){const e=$("#tags").editableList("items"),t=$("#devices").editableList("items"),a=new Set,n=new Set;e.each((function(){const e=$(this).find("select").val();a.add(e)})),t.each((function(){const e=$(this).find(".input-device").val();e.trim().replace(/\s/g,"").length&&n.add(e)})),this.tags=Array.from(a),this.devices=Array.from(n),this.outputProperties=B(),this.haConfig=I()}},ct={category:"home_assistant",color:U.nodeColors.haBlue,outputs:1,icon:"font-awesome/fa-clock-o",paletteLabel:"time",label:function(){return this.name||(this.entityId?`${this.entityId}.${this.property||"state"}`:"time")},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("haTimeVersion",0)},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},entityId:{value:"",required:!0},property:{value:""},offset:{value:"0"},offsetType:{value:"num"},offsetUnits:{value:"minutes"},randomOffset:{value:!1},repeatDaily:{value:!1},outputProperties:{value:[{property:"payload",propertyType:"msg",value:"",valueType:"entityState"},{property:"data",propertyType:"msg",value:"",valueType:"entity"},{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"}],validate:q},sunday:{value:!0},monday:{value:!0},tuesday:{value:!0},wednesday:{value:!0},thursday:{value:!0},friday:{value:!0},saturday:{value:!0},debugenabled:{value:!1},payload:{value:void 0},payloadType:{value:void 0}},oneditprepare:function(){U.setup();const e=$("#node-input-server"),t=$("#node-input-entityId");Z(this,"#node-input-server"),w(this),Le({root:"#node-input-entityId"}),$("#node-input-property").autocomplete({source:(a,n)=>{const i=function(e,t){if(!(e in r))return[];const a=t in r[e]?Object.keys(y(r[e][t])):Object.values(r[e]).map((e=>Object.keys(y(e))));return[...new Set([].concat(...a))].sort(((e,t)=>!e.includes(".")&&t.includes(".")?-1:e.includes(".")&&!t.includes(".")?1:e<t?-1:e>t?1:0))}(e.val(),t.val());n($.ui.autocomplete.filter(i,a.term))},minLength:0}),$("#node-input-offset").typedInput({types:["num","jsonata"],typeField:"#node-input-offsetType"}),$("#node-input-payload").typedInput({types:["str","num","bool","jsonata","date"],typeField:"#node-input-payloadType"}),$("#node-input-repeatDaily").on("change",(function(){$("#days-of-the-week").toggle($(this).is(":checked"))})).trigger("change"),F(this.outputProperties,{extraTypes:["entityState","entityId","entity"]})},oneditsave:function(){this.haConfig=I(),this.outputProperties=B()}},vt={category:"home_assistant",color:U.nodeColors.haBlue,inputs:0,outputs:2,outputLabels:function(e){if(0===e)return"allowed";if(1===e)return"blocked";const t=this.customoutputs[e-2];let a;return a="always"===t.comparatorPropertyType?"always sent":`${t.comparatorPropertyType.replace("_"," ")} ${t.comparatorType.replace("_","")} ${t.comparatorValue}`,a},icon:"font-awesome/fa-map-signs",paletteLabel:"trigger: state",label:function(){return this.name||`trigger-state: ${this.entityid}`},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("triggerStateVersion",0)},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},entityid:{value:"",required:!0},entityidfiltertype:{value:"exact"},debugenabled:{value:!1},constraints:{value:[{targetType:"this_entity",targetValue:"",propertyType:"current_state",propertyValue:"new_state.state",comparatorType:"is",comparatorValueDatatype:"str",comparatorValue:""}]},inputs:{value:0},outputs:{value:2},customoutputs:{value:[]},outputinitially:{value:!1},state_type:{value:"str"},enableInput:{value:!1}},oneditprepare:function(){U.setup();const t=$("#constraint-list"),a=$("#output-list");Z(this,"#node-input-server",(()=>{n.serverChanged()}));const n=new nt({filterTypeSelector:"#node-input-entityidfiltertype",entityId:this.entityid});$("#dialog-form").data("entitySelector",n);let i=[],o=[],s=[];K("entities",(e=>{i=e})),K("properties",(e=>{o=e,s=[...e.map((e=>`new_state.${e}`)),...e.map((e=>`old_state.${e}`))].sort()})),w(this);const r=$("#node-input-outputs").val('{"0": 0, "1": 1}'),l=()=>JSON.parse(r.val()),p=e=>{r.val(JSON.stringify(e))},u=e=>{a.editableList("items").each((function(t){const a=$(this).data("data");e[Object.prototype.hasOwnProperty.call(a,"index")?a.index:a._index]=t+2}))};t.on("change",".target-type",(function(){const e=$(this),t="this_entity"===e.val(),a=e.parent().parent(),n=e.next(),i=a.find(".property-type");t?n.attr("disabled","disabled").val(""):n.removeAttr("disabled"),i.find("option[value=previous_state]").toggle(t),"previous_state"===i.val()&&i.val("current_state").trigger("change")})),t.on("change",".property-type",(function(e){const t=e.target.value;"current_state"===t||"previous_state"===t?$(this).next().attr("disabled","disabled").val(""):$(this).next().removeAttr("disabled")})),a.on("change",".comparator-property-type",(function(e){const t=e.target.value,a=$(this).parent().parent(),n=a.find(".comparator-type"),i=a.find(".comparator-value"),o=a.find(".comparator-property-value");switch(t){case"always":o.attr("disabled","disabled"),n.attr("disabled","disabled"),i.attr("disabled","disabled"),o.val("");break;case"previous_state":case"current_state":o.attr("disabled","disabled"),n.removeAttr("disabled"),i.removeAttr("disabled"),o.val("");break;case"property":o.removeAttr("disabled"),n.removeAttr("disabled"),i.removeAttr("disabled")}}));t.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append(e("trigger-state.label.conditions")),addItem:(e,t,a)=>{if($("#constraint-template").children().clone().appendTo(e),e.find(".target-value").autocomplete({source:(e,t)=>{const a=e.term.toLowerCase(),n=i.filter((e=>e.includes(a)));t(n)},minLength:0}),e.find(".property-value").autocomplete({source:(t,a)=>{const n=t.term.toLowerCase();a(("this_entity"===e.find(".target-type").val()?s:o).filter((e=>e.includes(n))))},minLength:0}),e.find(".comparator-value").typedInput({default:"str",types:["str","num","bool","re","jsonata",{value:"entity",label:"entity."},{value:"prevEntity",label:"prev entity."}]}),$.isEmptyObject(a))return;e.find(".target-type").val(a.targetType).trigger("change"),e.find(".target-value").val(a.targetValue),e.find(".property-type").val(a.propertyType).trigger("change"),"property"===a.propertyType&&e.find(".property-value").val(a.propertyValue),e.find(".comparator-type").val(a.comparatorType);const n=e.find(".comparator-value");n.typedInput("type",a.comparatorValueDatatype),n.typedInput("value",a.comparatorValue)}}),t.editableList("addItems",this.constraints.length?this.constraints:[]),a.on("change",".message-type",(function(e){const t=e.target.value;$(this).parent().find(".message-value").typedInput("default"===t?"hide":"show")})),a.on("change",".comparator-property-type",(function(e){const t=e.target.value,a=$(this).parent().parent(),n=a.find(".comparator-property-value"),i=a.find(".comparator-type"),o=a.find(".comparator-value");switch(t){case"always":n.attr("disabled","disabled"),i.attr("disabled","disabled"),o.typedInput("hide"),n.val("");break;case"previous_state":case"current_state":n.attr("disabled","disabled"),i.removeAttr("disabled"),o.typedInput("show"),n.val("");break;case"property":n.removeAttr("disabled"),i.removeAttr("disabled"),o.typedInput("show")}})),a.editableList({addButton:!0,removable:!0,sortable:!0,height:"auto",header:$("<div>").append("Custom outputs"),addItem:function(e,t,a){a.hasOwnProperty("condition")||(a.condition={});const n=a.condition;a.hasOwnProperty("index")||(a._index=Math.floor(563609*Math.random()).toString()),$("#output-template").children().clone().appendTo(e),e.css({overflow:"hidden",whiteSpace:"nowrap"}),e.find(".message-value").typedInput({default:"json",types:["str","num","bool","json"]}),e.find(".comparator-property-value").autocomplete({source:(e,t)=>{const a=e.term.toLowerCase();t(s.filter((e=>e.includes(a))))},minLength:0}),e.find(".comparator-value").typedInput({default:"str",types:["str","num","bool","re","jsonata",{value:"entity",label:"entity."},{value:"prevEntity",label:"prev entity."}]});const i=l();if(i[a.hasOwnProperty("index")?a.index:a._index]=t+2,p(i),$.isEmptyObject(n))return void e.find(".message-type,.comparator-property-type").trigger("change");e.find(".message-type").val(n.messageType).trigger("change");const o=e.find(".message-value");o.typedInput("value",n.messageValue),o.typedInput("type",n.messageValueType),e.find(".comparator-property-type").val(n.comparatorPropertyType).trigger("change"),"property"===n.comparatorPropertyType&&e.find(".comparator-property-value").val(n.comparatorPropertyValue),e.find(".comparator-type").val(n.comparatorType);const r=e.find(".comparator-value");r.typedInput("value",n.comparatorValue),r.typedInput("type",n.comparatorValueDataType)},removeItem:function(e){const t=l();Object.prototype.hasOwnProperty.call(e,"index")?t[e.index]=-1:delete t[e._index],u(t),p(t)},sortItems:function(){const e=l();u(e),p(e)}}),this.customoutputs.forEach(((e,t)=>a.editableList("addItem",{condition:e,index:t+2})))},oneditsave:function(){const e=$("#constraint-list").editableList("items"),t=$("#output-list").editableList("items"),a=[],n=[];e.each((function(){const e=$(this),t=e.find(".comparator-value"),n={targetType:e.find(".target-type").val(),targetValue:e.find(".target-value").val(),propertyType:e.find(".property-type").val(),propertyValue:e.find(".property-value").val(),comparatorType:e.find(".comparator-type").val(),comparatorValueDatatype:t.typedInput("type"),comparatorValue:t.typedInput("value")};"current_state"===n.propertyType?n.propertyValue="new_state.state":"previous_state"===n.propertyType&&(n.propertyValue="old_state.state"),"includes"!==n.comparatorType&&"does_not_include"!==n.comparatorType||(n.comparatorValueDatatype="list"),a.push(n)})),t.each((function(){const e=$(this),t=e.find(".message-value"),a=e.find(".comparator-value"),i={messageType:e.find(".message-type").val(),messageValue:t.typedInput("value"),messageValueType:t.typedInput("type"),comparatorPropertyType:e.find(".comparator-property-type").val(),comparatorPropertyValue:e.find(".comparator-property-value").val(),comparatorType:e.find(".comparator-type").val(),comparatorValue:a.typedInput("value"),comparatorValueDataType:a.typedInput("type")};"current_state"===i.comparatorPropertyType?i.comparatorPropertyValue="new_state.state":"previous_state"===i.comparatorPropertyType&&(i.comparatorPropertyValue="old_state.state"),"includes"!==i.comparatorType&&"does_not_include"!==i.comparatorType||(i.comparatorValueDataType="list"),n.push(i)})),$("#node-input-inputs").val($("#node-input-enableInput").is(":checked")?1:0),this.constraints=a,this.customoutputs=n,this.haConfig=I();const i=$("#dialog-form").data("entitySelector");this.entityid=i.entityId,i.destroy()},oneditcancel:function(){$("#dialog-form").data("entitySelector").destroy()}},yt={category:"home_assistant",color:U.nodeColors.haBlue,inputs:1,outputs:1,outputLabels:["","timed out"],icon:"ha-wait-until.svg",paletteLabel:"wait until",label:function(){return this.name||"wait until"},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("haWaitUntilVersion",0)},outputs:{value:1},entityId:{value:""},entityIdFilterType:{value:"exact"},property:{value:""},comparator:{value:"is"},value:{value:""},valueType:{value:"str"},timeout:{value:"0"},timeoutType:{value:"num"},timeoutUnits:{value:"seconds"},entityLocation:{value:"data"},entityLocationType:{value:"none"},checkCurrentState:{value:!0},blockInputOverrides:{value:!0}},oneditprepare:function(){U.setup(),Z(this,"#node-input-server",(()=>{e.serverChanged()}));const e=new nt({filterTypeSelector:"#node-input-entityIdFilterType",entityId:this.entityId});$("#dialog-form").data("entitySelector",e);let t=[];K("properties",(e=>{t=e,$("#node-input-property").autocomplete({source:t,minLength:0})}));const a={value:"entity",label:"entity."},n=["str","num","bool","re","jsonata","msg","flow","global",a];$("#node-input-value").typedInput({default:"str",types:n,typeField:"#node-input-valueType"}),$("#node-input-comparator").on("change",(function(){let e=n;const t=$(this).val();switch($("#node-input-property").prop("disabled","jsonata"===t),t){case"is":case"is_not":break;case"lt":case"lte":case"gt":case"gte":e=["num","jsonata","msg","flow","global",a];break;case"includes":case"does_not_include":e=["str","jsonata","msg","flow","global"];break;case"jsonata":e=["jsonata"]}$("#node-input-value").typedInput("types",e)}));const i=this;$("#node-input-timeout").typedInput({default:"num",types:["num","jsonata"],typeField:"#node-input-timeoutType"}).on("change",(function(e,t){!0!==t&&(i.outputs="jsonata"===t||"num"===t&&Number($(this).val())>0?2:1)}));$("#node-input-entityLocation").typedInput({types:["msg","flow","global",{value:"none",label:"None",hasValue:!1}],typeField:"#node-input-entityLocationType"});const o=$("#node-input-entityIdFilterType");o.on("change",(function(){$(".exact-only").toggle("exact"===o.val())}))},oneditsave:function(){const e=$("#dialog-form").data("entitySelector");this.entityId=e.entityId,e.destroy()},oneditcancel:function(){$("#dialog-form").data("entitySelector").destroy()}};function ht(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Array.from({length:e},(()=>t[Math.floor(Math.random()*t.length)])).join("")}const gt={category:"home_assistant",color:U.nodeColors.haBlue,outputs:1,outputLabels:"",icon:"ha-webhook.svg",paletteLabel:"webhook",label:function(){return this.name||"webhook"},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("haWebhookVersion",0)},outputs:{value:1},webhookId:{value:ht(32),required:!0},outputProperties:{value:[{property:"topic",propertyType:"msg",value:"",valueType:"triggerId"},{property:"payload",propertyType:"msg",value:"",valueType:"data"}],validate:q},payloadLocation:{value:!1},payloadLocationType:{value:!1},headersLocation:{value:!1},headersLocationType:{value:!1}},oneditprepare:function(){U.setup(),Z(this,"#node-input-server"),w(this);const e=$("#node-input-webhookId");$("#copyId").on("click",(function(){const t=e.get(0),a=t.value;t.value=`https://<ip>:<port>/api/webhook/${a}`,t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),t.value=a})),$("#refresh").on("click",(function(){e.val(ht(32))})),F(this.outputProperties,{extraTypes:["receivedData","headers","params","triggerId"]})},oneditsave:function(){this.outputProperties=B()}},ft={category:"home_assistant",color:U.nodeColors.haBlue,outputs:1,icon:"font-awesome/fa-map-marker",paletteLabel:"zone",label:function(){return this.name||"zone"},labelStyle:U.labelStyle,defaults:{name:{value:""},server:{value:"",type:"server",required:!0},version:{value:RED.settings.get("haZoneVersion",0)},exposeToHomeAssistant:{value:!1},haConfig:{value:[{property:"name",value:""},{property:"icon",value:""}]},entities:{value:[""],required:!0,validate:e=>!!e.length},event:{value:"enter"},zones:{value:[""],required:!0,validate:e=>!!e.length}},oneditprepare:function(){U.setup();const e=$("#entities"),t=$("#zones");Z(this,"#node-input-server"),w(this),e.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append("Entities"),addItem:function(e,t,a){const n=$("<div />").appendTo(e);$("<span />",{text:"Entity",style:"padding-right: 35px;"}).appendTo(n);const i=$.isEmptyObject(a)?"":a;Le({root:$("<input />",{type:"text",class:"input-entity"}).appendTo(n).val(i),options:{type:"trackers"}})}}),e.editableList("addItems",this.entities),t.editableList({addButton:!0,removable:!0,height:"auto",header:$("<div>").append("zones"),addItem:function(e,t,a){const n=$("<div />").appendTo(e);$("<span />",{text:"Zone",style:"padding-right: 35px;"}).appendTo(n);const i=$.isEmptyObject(a)?"":a;Le({root:$("<input />",{type:"text",class:"input-zone"}).appendTo(n).val(i),options:{type:"zones"}})}}),t.editableList("addItems",this.zones)},oneditsave:function(){const e=$("#entities").editableList("items"),t=$("#zones").editableList("items"),a=new Set,n=new Set;e.each((function(){const e=$(this).find(".input-entity").val().replace(/\s/g,"");e.length&&a.add(e)})),t.each((function(){const e=$(this).find(".input-zone").val().replace(/\s/g,"");e.length&&n.add(e)})),this.entities=Array.from(a),this.zones=Array.from(n),this.haConfig=I()}};RED.comms.subscribe("homeassistant/areas/#",(function(e,t){const a=u(e);o[a]=t})),RED.comms.subscribe("homeassistant/devices/#",(function(e,t){const a=u(e);s[a]=t})),RED.comms.subscribe("homeassistant/entity/#",(function(e,t){const a=u(e);r[a]||(r[a]={}),r[a][t.entity_id]=t})),RED.comms.subscribe("homeassistant/entities/#",(function(e,t){const a=u(e);r[a]=t})),RED.comms.subscribe("homeassistant/integration/#",(function(e,t){const a=e.split("/")[2];b[a]=t.version})),RED.comms.subscribe("homeassistant/services/#",(function(e,t){const a=u(e);l[a]=t})),RED.comms.subscribe("homeassistant/targetDomains/#",(function(e,t){const a=u(e);p[a]=t})),function(){const t="home-assistant.ui.migrations",a=e(`${t}.title`),n=e(`${t}.warning`),i=e(`${t}.message`),o=e(`${t}.button_label`),s=e("home-assistant.ui.notifications.attention"),r=$.parseHTML(`<div id="ha-dialog-confirm" title="${a}">\n            ${i}\n            <div class="ui-state-error ha-alert-box"><strong>${s}:</strong> ${n}</div>\n        </div>`),l=$.parseHTML(`<li><button id="upgrade-ha-node"><i class="fa fa-refresh"></i> ${o}</button></li>`);$("body").append(r),$("#red-ui-header .red-ui-header-toolbar").prepend(l)}(),D=$("#upgrade-ha-node"),D.hide(),D.on("click",L),RED.editor.registerTypeEditor("ha_entity_filter",f),RED.events.on("nodes:add",(function(e){C(e)&&!S(e)&&D.show()})),RED.events.on("nodes:remove",(function(e){D.is(":visible")&&C(e)&&0===R()&&D.hide()})),RED.events.on("editor:open",(function(){var t;const a=RED.view.selection(),n=null===(t=null==a?void 0:a.nodes)||void 0===t?void 0:t[0];n&&C(n)&&!S(n)&&(E(n),RED.nodes.dirty(!0),RED.notify(e("home-assistant.ui.migrations.node_schema_updated")))})),RED.nodes.registerType("ha-api",ie),RED.nodes.registerType("ha-button",oe),RED.nodes.registerType("ha-entity-config",Ze),RED.nodes.registerType("api-call-service",ke),RED.nodes.registerType("server",De),RED.nodes.registerType("api-current-state",Ce),RED.nodes.registerType("ha-device",qe),RED.nodes.registerType("ha-entity",Ge),RED.nodes.registerType("server-events",Ke),RED.nodes.registerType("server-state-changed",it),RED.nodes.registerType("ha-fire-event",ot),RED.nodes.registerType("ha-get-entities",st),RED.nodes.registerType("api-get-history",rt),RED.nodes.registerType("poll-state",lt),RED.nodes.registerType("api-render-template",ut),RED.nodes.registerType("ha-tag",dt),RED.nodes.registerType("ha-time",ct),RED.nodes.registerType("trigger-state",vt),RED.nodes.registerType("ha-wait-until",yt),RED.nodes.registerType("ha-webhook",gt),RED.nodes.registerType("ha-zone",ft)}();</script>
<script type="text/html" data-template-name="ha-api"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name">Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server">Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-protocol">Protocol</label> <select type="text" id="node-input-protocol" style="width:70%"><option value="websocket">WebSocket</option><option value="http">HTTP</option></select></div><div class="form-row http"><label for="node-input-method">Method</label> <select type="text" id="node-input-method" style="width:70%"><option value="get">GET</option><option value="post">POST</option></select></div><div class="form-row http"><label for="node-input-path">Path</label> <input type="text" id="node-input-path" placeholder="config"></div><div class="form-row"><label id="data-label" for="node-input-data">Data</label> <input type="text" id="node-input-data" style="width:70%"> <input type="hidden" id="node-input-dataType"></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row http"><label for="node-input-responseType">Return</label> <select id="node-input-responseType" style="width:70%"><option value="text">a UTF-8 string</option><option value="arraybuffer">a binary buffer</option><option value="json">a parsed JSON object</option></select></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled">Show Debug Information</label></div></script>
<script type="text/html" data-template-name="ha-button"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><span data-i18n="home-assistant.label.name"></span></label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-entityConfig"><span data-i18n="home-assistant.label.entity_config"></span></label> <input type="text" id="node-input-entityConfig"></div><div class="form-row"><ol id="custom-outputs"></ol></div></script>
<style>#version-update{margin-bottom:1em;padding:.5em}#version-update p{margin:0}#version-update strong{padding-right:5px}#version-update a,#version-update a:hover{color:var(--red-ui-primary-text-color)}.home-assistant .form-row.checkbox-option input{display:inline-block;margin-left:105px;margin-right:5px;vertical-align:top;width:auto}.home-assistant .form-row.checkbox-option label{width:auto}.home-assistant .form-row.checkbox-option-left input{display:inline-block;margin-right:5px;vertical-align:top;width:auto}.home-assistant .form-row.checkbox-option-left label{margin-right:20px;width:auto}.home-assistant .form-row.add-spacer{border-bottom:1px solid var(--red-ui-primary-text-color)}.home-assistant .form-row>select{width:70%}.home-assistant .form-row .ha-multi-item-row{display:inline-flex;gap:10px;width:70%}.home-assistant .form-row .ha-multi-item-row select{width:auto}.home-assistant .form-row .ha-multi-item-row .red-ui-typedInput-container{flex:1;width:auto}.home-assistant .editable-list-row{margin-bottom:4px}.home-assistant li span.property-type{color:var(--red-ui-primary-text-color);float:right;font-family:Helvetica Neue,Arial,Helvetica,sans-serif;font-size:11px;font-style:italic}.home-assistant .ha-alert-box,.home-assistant .ha-alpha-box,.home-assistant .ha-beta-box{border-radius:4px;margin-bottom:10px;padding:10px}.home-assistant .ha-alpha-box{background-color:#e78bb9;color:#702323}.home-assistant .ha-beta-box{background-color:#7d7;color:#853e3d}#constraint-list{min-width:446px}#constraint-list input{width:65%}#output-list input{width:62%}#clearIfState{margin-left:2px;position:absolute}.ha-node-label-legacy{fill:#fdfd96;stroke-width:0;font-size:14px;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.home-assistant-custom-block .custom-block-title{font-weight:600}.home-assistant-custom-block.danger,.home-assistant-custom-block.tip,.home-assistant-custom-block.warning{border-left-style:solid;border-left-width:.5rem;margin:1rem 0;padding:.1rem 1.5rem}.home-assistant-custom-block.tip{background-color:#f3f5f7;border-color:#42b983;color:#2c3e50}.home-assistant-custom-block.tip a{color:#3eaf7c}.home-assistant-custom-block.warning{background-color:#fff6c6;border-color:#e7c000;color:#6b5900}.home-assistant-custom-block.warning .custom-block-title{color:#b29400}.home-assistant-custom-block.warning a{color:#2c3e50}.home-assistant-custom-block.danger{background-color:#ffe6e6;border-color:#c00;color:#4d0000}.home-assistant-custom-block.danger .custom-block-title{color:#900}.home-assistant-custom-block.danger a{color:#2c3e50}.home-assisant-badge{border-radius:3px;color:#fff;display:inline-block;font-size:12px;height:16px;line-height:16px;padding:0 6px}.home-assisant-badge,.home-assisant-badge.green,.home-assisant-badge.tip{background-color:#42b983}.home-assisant-badge.error{background-color:#da5961}.home-assisant-badge.warn,.home-assisant-badge.warning,.home-assisant-badge.yellow{background-color:#e7c000}.home-assisant-badge+.home-assisant-badge{margin-left:5px}#upgrade-ha-node{background:#41bdf5;border:0;color:#eee;display:inline-block;font-size:14px;line-height:22px;margin:0;padding:4px 12px;text-decoration:none}.ui-autocomplete .ui-menu-item-wrapper .sublabel{color:var(--red-ui-secondary-text-color);font-size:smaller;margin:4px 0}</style>
<style>.ha-entity-selector{align-items:flex-end;display:inline-flex;gap:10px;width:70%}.ha-entity-selector>input[type=text]{flex:1}.ha-entity-selector .select2-container{flex:1;width:auto}.ha-entity-selector .select2-container .select2-search--inline .select2-search__field{height:22px}#node-input-entityIdFilterType,#node-input-entityidfiltertype{width:auto}.home-assistant .ha-entity-search-row{align-items:baseline;display:flex;margin-bottom:10px}.home-assistant .ha-entity-search-row label{display:inline;width:auto}.home-assistant .ha-entity-search-row input{background-color:var(--red-ui-form-input-background);border:1px solid var(--red-ui-form-input-border-color);border-radius:4px;box-sizing:border-box;color:var(--red-ui-primary-text-color);display:inline-block;flex:1;font-size:14px;height:34px;line-height:20px;margin-bottom:10px;margin-left:10px;padding:6px;vertical-align:middle}.home-assistant .ha-entity-search-row input:focus{border-color:var(--red-ui-form-input-border-color-focus);outline:0}.home-assistant .ha-entity-search-row ul{list-style:none;margin:0;overflow:hidden;overflow-y:auto;padding:0}</style>
<script type="text/html" data-template-name="api-call-service"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name" data-i18n="home-assistant.label.name"></label> <input type="text" id="node-input-name"></div><div class="form-row"><label for="node-input-server" data-i18n="home-assistant.label.server"></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-domain" data-i18n="api-call-service.label.domain"></label> <select id="node-input-domain" style="width:70%"></select></div><div class="form-row"><label for="node-input-service" data-i18n="api-call-service.label.service"></label> <select id="node-input-service" style="width:70%"></select></div><div class="form-row"><label for="node-input-areaId" data-i18n="api-call-service.label.area"></label> <select id="node-input-areaId" multiple="multiple" style="width:70%"></select></div><div class="form-row"><label for="node-input-deviceId" data-i18n="api-call-service.label.device"></label> <select id="node-input-deviceId" multiple="multiple" style="width:70%"></select></div><div class="form-row"><label for="node-input-entityId" data-i18n="api-call-service.label.entity"></label> <select id="node-input-entityId" multiple="multiple" style="width:70%"></select></div><div class="form-row"><label for="node-input-data" data-i18n="api-call-service.label.data"></label> <input type="text" id="node-input-data" style="width:70%"> <input type="hidden" id="node-input-dataType"></div><div class="form-row checkbox-option" id="mustacheAltTags"><input type="checkbox" id="node-input-mustacheAltTags">&nbsp; <label for="node-input-mustacheAltTags" data-i18n="api-call-service.label.alternate_tags"></label></div><div class="form-row"><label for="node-input-mergeContext" data-i18n="api-call-service.label.merge_context"></label> <input type="text" id="node-input-mergeContext" placeholder="lightOptions"></div><div class="form-row"><label for="node-input-queue" data-i18n="api-call-service.label.queue"></label> <select type="text" id="node-input-queue"><option value="none" data-i18n="api-call-service.label.queue_none"></option><option value="first" data-i18n="api-call-service.label.queue_first"></option><option value="all" data-i18n="api-call-service.label.queue_all"></option><option value="last" data-i18n="api-call-service.label.queue_last"></option></select></div><div class="form-row"><ol id="custom-outputs"></ol></div><div id="service-data-desc" class="form-row"><button id="example-data" style="float:right" class="red-ui-button red-ui-button-small" data-i18n="api-call-service.label.load_example_data"></button><h4>Service: <span class="title"></span></h4><div class="unknown-service">Unknown domain or service</div><div class="known-service"><p class="service-description"></p><table id="service-data-table" class="red-ui-info-table"><thead><tr><th>Property</th><th>Desc</th><th>Example</th></tr></thead><tbody></tbody></table></div></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled" data-i18n="api-call-service.label.show_debug"></label></div></script>
<script type="text/html" data-template-name="server"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-config-input-name">Name</label> <input type="text" id="node-config-input-name"></div><div class="form-row checkbox-option"><input type="checkbox" id="node-config-input-addon"> <label for="node-config-input-addon">I use the Home Assistant Add-on</label></div><div class="form-row addon checkbox-option"><input type="checkbox" id="node-config-input-connectionDelay"> <label for="node-config-input-connectionDelay">Delay connection attempts</label></div><div id="server-info"><div class="form-row"><label for="node-config-input-host">Base URL</label><div style="width:70%;display:inline-flex"><input type="text" id="node-config-input-host" placeholder="http://localhost:8123" style="flex-grow:1"> <a id="discoverInstances" class="red-ui-button" style="margin-left:10px"><i class="fa fa-search"></i></a></div></div><div class="form-row"><label id="access-token-label" for="node-config-input-access_token">Access Token</label> <input type="text" id="node-config-input-access_token" placeholder="access token"></div><div class="form-row checkbox-option"><input type="checkbox" id="accept_unauthorized_certs"> <label for="accept_unauthorized_certs">Accept Unauthorized SSL Certificates</label></div></div><div class="form-row"><label for="node-config-input-ha_boolean">State Boolean</label> <input type="text" id="node-config-input-ha_boolean" placeholder="y|yes|true|on|home|open"></div><div class="form-row checkbox-option"><input type="checkbox" id="node-config-input-cacheJson"> <label for="node-config-input-cacheJson">Cache Autocomplete Results</label></div><div class="form-row checkbox-option"><input type="checkbox" id="node-config-input-heartbeat"> <label for="node-config-input-heartbeat">Enable Heartbeat</label></div><div class="form-row" id="heartbeatIntervalRow"><label for="node-config-input-heartbeatInterval">Heartbeat Interval</label><div style="vertical-align:text-bottom;width:70%;display:inline-block"><input type="number" id="node-config-input-heartbeatInterval" style="width:30%" min="10"> Seconds</div></div></script>
<script type="text/html" data-template-name="api-current-state"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"> <input type="hidden" id="node-input-outputs"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entity_id"><i class="fa fa-cube"></i> Entity ID</label> <input type="text" id="node-input-entity_id"></div><div class="form-row"><label for="node-input-halt_if_compare"><i class="fa fa-check-square"></i> If State</label> <select type="text" id="node-input-halt_if_compare" style="width:20%"><option value="is">is</option><option value="is_not">is not</option><option value="lt">&lt;</option><option value="lte">&lt;=</option><option value="gt">&gt;</option><option value="gte">&gt;=</option><option value="includes">in</option><option value="does_not_include">not in</option><option value="jsonata">JSONata</option></select> <input type="text" id="node-input-halt_if" style="width:50%"> <input type="hidden" id="node-input-halt_if_type"></div><div class="form-row" id="for-row"><label for="node-input-for"><i class="fa fa-clock-o"></i> For</label> <input type="text" id="node-input-for" style="width:45%"> <input type="hidden" id="node-input-forType"> <select id="node-input-forUnits" style="width:25%"><option value="milliseconds">milliseconds</option><option value="seconds">seconds</option><option value="minutes">minutes</option><option value="hours">hours</option><option value="days">days</option></select></div><div class="form-row"><label for="node-input-state_type"><i class="fa fa-tint"></i> State Type</label> <select type="text" id="node-input-state_type" style="width:auto"><option value="str">String</option><option value="num">Number</option><option value="habool">Boolean</option></select></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-blockInputOverrides">&nbsp; <label for="node-input-blockInputOverrides">Block Input Overrides</label></div></script>
<script type="text/html" data-template-name="ha-device"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name" data-i18n="ha-device.label.name"><i class="fa fa-tag"></i></label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server" data-i18n="ha-device.label.server"><i class="fa fa-server"></i></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-deviceType"><span data-i18n="ha-device.label.type"></span></label> <select id="node-input-deviceType" style="width:70%"><option value="trigger" data-i18n="ha-device.label.trigger"></option><option value="action" data-i18n="ha-device.label.action"></option></select></div><div class="form-row"><label for="node-input-device" data-i18n="ha-device.label.device"></label> <select id="node-input-device" style="width:70%"></select></div><div class="form-row"><label for="event" data-i18n="ha-device.label.trigger"></label> <select id="event" style="width:70%" disabled="disabled"></select></div><div class="form-row"><ol id="custom-outputs"></ol></div></script>
<style>.select2-container--nodered{font-family:var(--red-ui-primary-font)}.select2-container--nodered .select2-selection--single{background-color:var(--red-ui-form-background);border:1px solid var(--red-ui-form-input-border-color);border-radius:4px;height:34px!important}.select2-container--nodered .select2-selection--single .select2-selection__rendered{color:var(--red-ui-form-text-color);line-height:34px}.select2-container--nodered .select2-selection--single .select2-selection__clear{cursor:pointer;float:right;font-weight:700;height:34px;margin-right:20px;padding-right:0}.select2-container--nodered .select2-selection--single .select2-selection__placeholder{color:var(--red-ui-form-placeholder-color)}.select2-container--nodered .select2-selection--single .select2-selection__arrow{height:34px;position:absolute;right:1px;top:1px;width:20px}.select2-container--nodered .select2-selection--single .select2-selection__arrow b{border-bottom:0 solid transparent;border-left:4px solid transparent;border-right:4px solid transparent;border-top:5px solid var(--red-ui-secondary-text-color);height:0;left:50%;margin-left:-4px;margin-top:-2px;position:absolute;top:50%;width:0}.select2-container--nodered .select2-selection--single:focus{border-color:var(--red-ui-form-input-border-color-focus);outline-color:var(--red-ui-form-text-color);outline:0}.select2-container--nodered[dir=rtl] .select2-selection--single .select2-selection__clear{float:left}.select2-container--nodered[dir=rtl] .select2-selection--single .select2-selection__arrow{left:1px;right:auto}.select2-container--nodered.select2-container--disabled .select2-selection--single{background-color:var(--red-ui-list-item-background);cursor:default}.select2-container--nodered.select2-container--disabled .select2-selection--single .select2-selection__clear{display:none}.select2-container--nodered.select2-container--open .select2-selection--single .select2-selection__arrow b{border-bottom-color:var(--red-ui-secondary-text-color);border-left-color:transparent;border-right-color:transparent;border-top-color:transparent;border-width:0 4px 5px}.select2-container--nodered .select2-selection--multiple{background-color:var(--red-ui-form-background);border:1px solid var(--red-ui-form-input-border-color);border-radius:4px;cursor:text;min-height:34px;padding-bottom:5px;position:relative}.select2-container--nodered .select2-selection--multiple .select2-selection__rendered{margin:0}.select2-container--nodered .select2-selection--multiple.select2-selection--clearable{padding-right:25px}.select2-container--nodered .select2-selection--multiple .select2-selection__clear{cursor:pointer;font-weight:700;height:20px;margin-right:10px;margin-top:5px;padding:1px;position:absolute;right:0}.select2-container--nodered .select2-selection--multiple .select2-selection__choice{border-bottom:1px solid var(--red-ui-form-input-border-color);box-sizing:border-box;display:inline-block;max-width:100%;overflow:hidden;padding:4px 24px 4px 4px;position:relative;text-overflow:ellipsis;vertical-align:bottom;white-space:nowrap;width:100%}.select2-container--nodered .select2-selection--multiple .select2-selection__choice__display{cursor:default;padding-left:2px;padding-right:5px}.select2-container--nodered .select2-selection--multiple .select2-selection__choice__remove{background-color:transparent;border:none;border-left:1px solid var(--red-ui-form-input-border-color);color:var(--red-ui-list-item-secondary-color);cursor:pointer;font-size:1.5em;font-weight:700;padding:4px;position:absolute;right:0;top:0}.select2-container--nodered .select2-selection--multiple .select2-selection__choice__remove:focus,.select2-container--nodered .select2-selection--multiple .select2-selection__choice__remove:hover{background-color:var(--red-ui-list-item-background);color:var(--red-ui-list-item-background-selected);outline:none}.select2-container--nodered[dir=rtl] .select2-selection--multiple .select2-selection__choice{margin-left:5px;margin-right:auto}.select2-container--nodered[dir=rtl] .select2-selection--multiple .select2-selection__choice__display{padding-left:5px;padding-right:2px}.select2-container--nodered[dir=rtl] .select2-selection--multiple .select2-selection__choice__remove{border-bottom-left-radius:0;border-bottom-right-radius:4px;border-left:1px solid var(--red-ui-form-input-border-color);border-right:none;border-top-left-radius:0;border-top-right-radius:4px}.select2-container--nodered[dir=rtl] .select2-selection--multiple .select2-selection__clear{float:left;margin-left:10px;margin-right:auto}.select2-container--nodered.select2-container--focus .select2-selection--multiple{outline:0}.select2-container--nodered.select2-container--disabled .select2-selection--multiple{background-color:var(--red-ui-list-item-background);cursor:default}.select2-container--nodered.select2-container--disabled .select2-selection__choice__remove{display:none}.select2-container--nodered.select2-container--open.select2-container--above .select2-selection--multiple,.select2-container--nodered.select2-container--open.select2-container--above .select2-selection--single{border-top-left-radius:0;border-top-right-radius:0}.select2-container--nodered.select2-container--open.select2-container--below .select2-selection--multiple,.select2-container--nodered.select2-container--open.select2-container--below .select2-selection--single{border-bottom-left-radius:0;border-bottom-right-radius:0}.select2-container--nodered .select2-search--dropdown{background-color:var(--red-ui-list-item-background)}.select2-container--nodered .select2-search--dropdown .select2-search__field{background-color:var(--red-ui-form-background);border:1px solid var(--red-ui-form-input-border-color);color:var(--red-ui-list-item-color)}.select2-container--nodered .select2-search--dropdown .select2-search__field:focus{border-color:var(--red-ui-form-input-border-color-focus);outline-color:var(--red-ui-form-text-color);outline:0}.select2-container--nodered .select2-search--inline .select2-search__field{-webkit-appearance:textfield;background:transparent;border:none;box-shadow:none;margin-top:7px;outline:0}.select2-container--nodered .select2-results>.select2-results__options{background-color:var(--red-ui-list-item-background);max-height:200px;overflow-y:auto}.select2-container--nodered .select2-results__option{color:var(--red-ui-form-text-color);font-size:14px}.select2-container--nodered .select2-results__option .select2-results__option{padding-left:1em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__group{padding-left:0}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option{margin-left:-1em;padding-left:2em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-2em;padding-left:3em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-3em;padding-left:4em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-4em;padding-left:5em}.select2-container--nodered .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option{margin-left:-5em;padding-left:6em}.select2-container--nodered .select2-results__option .sublabel{color:var(--red-ui-secondary-text-color);font-size:smaller;margin:4px 0}.select2-container--nodered .select2-results__option--group{padding:0}.select2-container--nodered .select2-results__option--disabled{color:var(--red-ui-form-text-color-disabled)}.select2-container--nodered .select2-results__option--selected{background-color:var(--red-ui-list-item-background-selected)}.select2-container--nodered .select2-results__option--highlighted.select2-results__option--selectable{background-color:var(--red-ui-list-item-background-hover);color:var(--red-ui-list-item-color)}.select2-container--nodered .select2-results__option--highlighted.select2-results__option--selectable .sublabel{color:var(--red-ui-list-item-secondary-color)}.select2-container--nodered .select2-results__group{cursor:default;display:block;padding:6px}.select2-container--nodered .select2-dropdown{border-color:var(--red-ui-form-input-border-color)}</style>
<style>.deviceExtra>label{text-transform:capitalize}.deviceExtra>input[type=checkbox]{width:auto}.deviceExtra .range-row{align-items:center;display:inline-flex;width:70%}.deviceExtra .range-row input[type=checkbox]{width:auto}.deviceExtra .range-row input[type=range]{flex-grow:1;margin:0 10px}.deviceExtra .range-row input[type=text]{text-align:center;width:calc(3ch + 14px)}</style>
<script type="text/html" data-template-name="ha-entity"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><span data-i18n="ha-entity.label.name"></span></label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><span data-i18n="ha-entity.label.server"></span></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entityType"><span data-i18n="ha-entity.label.type"></span></label> <select id="node-input-entityType" style="width:70%"><option value="binary_sensor">Binary Sensor</option><option value="sensor">Sensor</option><option value="switch">Switch</option></select></div><div id="state-row" class="form-row optional-row"><label for="node-input-state"><span data-i18n="ha-entity.label.state"></span></label> <input type="text" id="node-input-state" style="width:70%"> <input type="hidden" id="node-input-stateType"></div><div id="attributes-row" class="form-row optional-row"><ol id="attributes"></ol></div><div id="config-row" class="form-row"><ol id="haConfig"></ol></div><div id="output-location-row" class="form-row optional-row"><label for="node-input-outputLocation"><span data-i18n="ha-entity.label.output_location"></span></label> <input type="hidden" id="node-input-outputLocationType"> <input type="text" id="node-input-outputLocation" style="width:68%"></div><div id="input-override-row" class="form-row optional-row"><label for="node-input-inputOverride"><span data-i18n="ha-entity.label.input_override"></span></label> <select id="node-input-inputOverride" style="width:68%"><option value="allow">Allow</option><option value="merge">Merge</option><option value="block">Block</option></select></div><div id="resend-row" class="form-row optional-row checkbox-option"><input type="checkbox" id="node-input-resend"> <label for="node-input-resend"><span data-i18n="ha-entity.label.resend"></span></label></div><div id="output-on-state-change-row" class="form-row optional-row checkbox-option"><input type="checkbox" id="node-input-outputOnStateChange"> <label for="node-input-outputOnStateChange"><span data-i18n="ha-entity.label.on_state_change"></span></label></div><div id="output-payload-row" class="form-row"><label for="node-input-outputPayload"><span data-i18n="ha-entity.label.payload"></span></label> <input type="text" id="node-input-outputPayload"> <input type="hidden" id="node-input-outputPayloadType"></div><div id="debug-row" class="form-row optional-row checkbox-option"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled"><span data-i18n="ha-entity.label.debug"></span></label></div></script>
<style>#haConfig label{margin-bottom:0;text-transform:none;width:100%}#haConfig span{display:inline-block;margin-right:5px;width:40%}#haConfig input[type=text]{margin-left:10px;width:55%}</style>
<script type="text/html" data-template-name="ha-entity-config"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-config-input-name"><span data-i18n="home-assistant.label.name"></span></label> <input type="text" id="node-config-input-name"></div><div class="form-row"><label for="node-config-input-server"><span data-i18n="home-assistant.label.server"></span></label> <select id="node-config-input-server" style="width:70%"></select></div><div class="form-row"><label for="node-config-input-entityType"><span data-i18n="ha-entity-config.label.type"></span></label> <select id="node-config-input-entityType" style="width:70%"><option value="button" data-i18n="ha-entity-config.label.button"></option></select></div></script>
<style>.home-assistant ul.ha-ignore-state{list-style:none;margin-left:105px}.home-assistant ul.ha-ignore-state li input{display:inline-block;margin-right:5px;vertical-align:top;width:auto}.home-assistant ul.ha-ignore-state li label{width:auto}</style>
<script type="text/html" data-template-name="server-events"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-dot-circle-o"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-event_type"><i class="fa fa-tag"></i> Event Type</label> <input type="text" id="node-input-event_type" placeholder="leave empty for all events"></div><div id="eventAlert" class="ui-state-error ha-alert-box"><strong>Alert:</strong> Leaving Event Type empty and listening for all events may overload the websocket message queue.</div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-waitForRunning"> <label for="node-input-waitForRunning">Output only after Home Assistant is running</label></div></script>
<style>#update-tag-list{margin-bottom:4px}#no-tags-found{display:none}</style>
<script type="text/html" data-template-name="server-state-changed"><input type="hidden" id="node-input-version"> <input type="hidden" id="node-input-outputs"><div class="form-row"><label for="node-input-name" data-i18n="home-assistant.label.name"></label> <input type="text" id="node-input-name"></div><div class="form-row"><label for="node-input-server" data-i18n="home-assistant.label.server"></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entityidfilter" data-i18n="home-assistant.label.entity"></label> <select type="text" id="node-input-entityidfiltertype"><option value="exact" data-i18n="home-assistant.label.select_option.exact"></option><option value="list" data-i18n="home-assistant.label.select_option.list"></option><option value="regex" data-i18n="home-assistant.label.select_option.regex"></option><option value="substring" data-i18n="home-assistant.label.select_option.substring"></option></select></div><div class="form-row"><label for="node-input-haltifstate" data-i18n="home-assistant.label.if_state"></label> <select id="node-input-halt_if_compare" style="width:20%"><option value="is" data-i18n="home-assistant.label.select_option.is"></option><option value="is_not" data-i18n="home-assistant.label.select_option.is_not"></option><option value="lt" data-i18n="home-assistant.label.select_option.less_than"></option><option value="lte" data-i18n="home-assistant.label.select_option.less_than_equal"></option><option value="gt" data-i18n="home-assistant.label.select_option.greater_than"></option><option value="gte" data-i18n="home-assistant.label.select_option.greater_than_equal"></option><option value="includes" data-i18n="home-assistant.label.select_option.in"></option><option value="does_not_include" data-i18n="home-assistant.label.select_option.not_in"></option><option value="jsonata" data-i18n="home-assistant.label.select_option.jsonata"></option></select> <input type="text" id="node-input-haltifstate" style="width:50%"> <input type="hidden" id="node-input-halt_if_type"></div><div class="form-row"><label for="node-input-for" data-i18n="home-assistant.label.for"></label>&nbsp;<div class="ha-multi-item-row"><input type="text" id="node-input-for"> <input type="hidden" id="node-input-forType"> <select id="node-input-forUnits"><option value="milliseconds" data-i18n="home-assistant.label.select_option.milliseconds"></option><option value="seconds" data-i18n="home-assistant.label.select_option.seconds"></option><option value="minutes" data-i18n="home-assistant.label.select_option.minutes"></option><option value="hours" data-i18n="home-assistant.label.select_option.hours"></option><option value="days" data-i18n="home-assistant.label.select_option.days"></option></select></div></div><div class="form-row"><label for="node-input-state_type" data-i18n="home-assistant.label.state_type"></label> <select type="text" id="node-input-state_type"><option value="str" data-i18n="home-assistant.label.select_option.string"></option><option value="num" data-i18n="home-assistant.label.select_option.number"></option><option value="habool" data-i18n="home-assistant.label.select_option.boolean"></option></select></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row add-spacer"><p data-i18n="server-state-changed.label.ignore_header"></p><ul class="ha-ignore-state"><li><input type="checkbox" id="node-input-ignorePrevStateNull"> <label for="node-input-ignorePrevStateNull" data-i18n="server-state-changed.label.ignore_prev_state_null"></label></li><li><input type="checkbox" id="node-input-ignorePrevStateUnknown"> <label for="node-input-ignorePrevStateUnknown" data-i18n="server-state-changed.label.ignore_prev_state_unknown"></label></li><li><input type="checkbox" id="node-input-ignorePrevStateUnavailable"> <label for="node-input-ignorePrevStateUnavailable" data-i18n="server-state-changed.label.ignore_prev_state_unavailable"></label></li><li><input type="checkbox" id="node-input-ignoreCurrentStateUnknown"> <label for="node-input-ignoreCurrentStateUnknown" data-i18n="server-state-changed.label.ignore_current_state_unknown"></label></li><li><input type="checkbox" id="node-input-ignoreCurrentStateUnavailable"> <label for="node-input-ignoreCurrentStateUnavailable" data-i18n="server-state-changed.label.ignore_current_state_unavailable"></label></li><li><input type="checkbox" id="node-input-output_only_on_state_change"> <label for="node-input-output_only_on_state_change" data-i18n="server-state-changed.label.output_only_on_state_change"></label></li></ul></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-outputinitially"> <label for="node-input-outputinitially" data-i18n="server-state-changed.label.output_on_connect"></label></div></script>
<style>#days-of-the-week{margin-left:30px}#days-of-the-week input{display:inline-block;margin-right:5px;vertical-align:top;width:auto}#days-of-the-week label{width:auto}</style>
<script type="text/html" data-template-name="ha-fire-event"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-dot-circle-o"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-data"><i class="fa fa-cube"></i> Event</label> <input type="text" id="node-input-event"></div><div class="form-row"><label for="node-input-data"><i class="fa fa-dot-circle-o"></i> Data</label> <input type="text" id="node-input-data" style="width:70%"> <input type="hidden" id="node-input-dataType"></div></script>
<script type="text/html" data-template-name="ha-get-entities"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><ol id="logic"></ol></div><div class="form-row"><label for="node-input-output_type">Output Type</label> <select id="node-input-output_type" style="width:70%"><option value="array">Array</option><option value="count">Count</option><option value="random">Random</option><option value="split">Split</option></select></div><div class="form-row checkbox-option output-option" id="output_empty_results"><input type="checkbox" id="node-input-output_empty_results"> <label for="node-input-output_empty_results">Send Empty Results</label></div><div class="form-row output-option" id="output_results_count"><label for="node-input-output_results_count" style="width:160px">Max Number of Results</label> <input type="text" id="node-input-output_results_count" style="width:150px"></div><div class="form-row output-option" id="output_location"><label for="node-input-output_location">Output Location</label> <input type="hidden" id="node-input-output_location_type"> <input type="text" id="node-input-output_location" style="width:70%"></div></script>
<script type="text/html" data-template-name="api-get-history"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><!-- Comparator Selection --><div class="form-row"><label for="node-input-entityid"><i class="fa fa-date"></i> Entity ID</label> <select type="text" id="node-input-entityidtype" style="width:18%"><option value="is">Is</option><option value="includes">Includes</option></select> <input type="text" id="node-input-entityid" style="width:52%"></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-useRelativeTime"> <label for="node-input-useRelativeTime">Use Relative Time</label></div><div class="form-row relative_row"><label for="node-input-relativeTime"><i class="fa fa-date"></i> In the Last</label> <input type="text" id="node-input-relativeTime" autofocus="autofocus" placeholder="20 minutes"></div><div class="form-row date_row"><label for="node-input-startdate"><i class="fa fa-date"></i> Start Date</label> <input type="text" id="node-input-startdate" autofocus="autofocus"></div><div class="form-row date_row"><label for="node-input-enddate"><i class="fa fa-date"></i> End Date</label> <input type="text" id="node-input-enddate"></div><div class="form-row form-tips date_row"><ul><li>dates must be in ISO format</li><li>example: "2018-01-27T13:00:00+00:00"</li></ul></div><div class="form-row form-tips relative_row"><p><code>timestring</code> will parse the following keywords into time values:</p><ol><li><code>ms, milli, millisecond, milliseconds</code> - will parse to milliseconds</li><li><code>s, sec, secs, second, seconds</code> - will parse to seconds</li><li><code>m, min, mins, minute, minutes</code> - will parse to minutes</li><li><code>h, hr, hrs, hour, hours</code> - will parse to hours</li><li><code>d, day, days</code> - will parse to days</li><li><code>w, week, weeks</code> - will parse to weeks</li><li><code>mon, mth, mths, month, months</code> - will parse to months</li><li><code>y, yr, yrs, year, years</code> - will parse to years</li></ol></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-flatten"> <label for="node-input-flatten">Flatten Results</label></div><div class="form-row"><label for="node-input-output_type">Output Type</label> <select id="node-input-output_type" style="width:70%"><option value="array">Array</option><option value="split">Split</option></select></div><div class="form-row output-option" id="output_location"><label for="node-input-output_location">Output Location</label> <input type="hidden" id="node-input-output_location_type"> <input type="text" id="node-input-output_location" style="width:70%"></div></script>
<script type="text/html" data-template-name="poll-state"><input type="hidden" id="node-input-version"> <input type="hidden" id="node-input-outputs"><div class="form-row"><label for="node-input-name">Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server">Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entity_id">Entity ID</label> <input type="text" id="node-input-entity_id"></div><div class="form-row"><label for="node-input-updateinterval">Update Interval</label> <input type="text" id="node-input-updateinterval" style="width:43%"> <input type="hidden" id="node-input-updateIntervalType"> <select id="node-input-updateIntervalUnits" style="width:27%"><option value="seconds">seconds</option><option value="minutes">minutes</option><option value="hours">hours</option></select></div><div class="form-row"><label for="node-input-halt_if_compare">If State</label> <select type="text" id="node-input-halt_if_compare" style="width:20%"><option value="is">is</option><option value="is_not">is not</option><option value="lt">&lt;</option><option value="lte">&lt;=</option><option value="gt">&gt;</option><option value="gte">&gt;=</option><option value="includes">in</option><option value="does_not_include">not in</option><option value="jsonata">JSONata</option></select> <input type="text" id="node-input-halt_if" style="width:50%"> <input type="hidden" id="node-input-halt_if_type"></div><div class="form-row"><label for="node-input-state_type">State Type</label> <select type="text" id="node-input-state_type" style="width:auto"><option value="str">String</option><option value="num">Number</option><option value="habool">Boolean</option></select></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-outputonchanged"> <label for="node-input-outputonchanged">Output on Changed</label></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-outputinitially"> <label for="node-input-outputinitially">Output on Connect</label></div></script>
<script type="text/html" data-template-name="api-render-template"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row" style="position:relative;margin-bottom:0"><label for="node-input-template"><i class="fa fa-file-code-o"></i> Template</label> <input type="hidden" id="node-input-template" autofocus="autofocus"></div><div class="form-row node-text-editor-row"><div style="height:250px;min-height:150px" class="node-text-editor" id="node-input-template-editor"></div></div><div class="form-row"><label for="node-input-templateLocation">Template</label> <input type="text" id="node-input-templateLocation" style="width:70%"> <input type="hidden" id="node-input-templateLocationType"></div><div class="form-row"><label for="node-input-resultsLocation">Results</label> <input type="text" id="node-input-resultsLocation" style="width:70%"> <input type="hidden" id="node-input-resultsLocationType"></div></script>
<script type="text/html" data-template-name="ha-tag"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name" data-i18n="home-assistant.label.name"><i class="fa fa-tag"></i></label> <input type="text" id="node-input-name" data-i18n="[placeholder]home-assistant.label.name"></div><div class="form-row"><label for="node-input-server" data-i18n="home-assistant.label.server"><i class="fa fa-server"></i></label> <input type="text" id="node-input-server"></div><div id="no-tags-found" class="ui-state-error ha-alert-box" data-i18n="ha-tag.errors.no_tags_found"><i class="fa fa-exclamation-triangle"></i></div><div class="form-row"><ol id="tags"></ol></div><div class="form-row"><ol id="devices"></ol></div><div class="form-row"><ol id="custom-outputs"></ol></div></script>
<script type="text/html" data-template-name="ha-time"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="ha-time.label.name"></span></label> <input type="text" id="node-input-name" data-i18n="[placeholder]ha-time.label.name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> <span data-i18n="ha-time.label.server"></span></label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-entityId"><i class="fa fa-cube"></i> <span data-i18n="ha-time.label.entity_id"></span></label> <input type="text" id="node-input-entityId"></div><div class="form-row"><label for="node-input-property"><i class="fa fa-edit"></i> <span data-i18n="ha-time.label.property"></span></label> <input type="text" id="node-input-property" placeholder="state"></div><div class="form-row"><label for="node-input-offset"><i class="fa fa-clock-o"></i> <span data-i18n="ha-time.label.offset"></span></label> <input type="text" id="node-input-offset" style="width:43%"> <input type="hidden" id="node-input-offsetType"> <select id="node-input-offsetUnits" style="width:27%"><option value="seconds" data-i18n="ha-time.label.seconds"></option><option value="minutes" data-i18n="ha-time.label.minutes"></option><option value="hours" data-i18n="ha-time.label.hours"></option></select></div><div class="form-row checkbox-option"><label><input type="checkbox" id="node-input-randomOffset"> <span data-i18n="ha-time.label.randomize_offset"></span></label></div><div class="form-row" id="entitiesFound"></div><div class="form-row"><ol id="custom-outputs"></ol></div><div class="form-row checkbox-option"><label><input type="checkbox" id="node-input-repeatDaily"> <span data-i18n="ha-time.label.repeat_daily"></span></label><div id="days-of-the-week"><div><input type="checkbox" checked="checked" id="node-input-sunday"> <label for="node-input-sunday" data-i18n="ha-time.label.sunday"></label></div><div><input type="checkbox" checked="checked" id="node-input-monday"> <label for="node-input-monday" data-i18n="ha-time.label.monday"></label></div><div><input type="checkbox" checked="checked" id="node-input-tuesday"> <label for="node-input-tuesday" data-i18n="ha-time.label.tuesday"></label></div><div><input type="checkbox" checked="checked" id="node-input-wednesday"> <label for="node-input-wednesday" data-i18n="ha-time.label.wednesday"></label></div><div><input type="checkbox" checked="checked" id="node-input-thursday"> <label for="node-input-thursday" data-i18n="ha-time.label.thursday"></label></div><div><input type="checkbox" checked="checked" id="node-input-friday"> <label for="node-input-friday" data-i18n="ha-time.label.friday"></label></div><div><input type="checkbox" checked="checked" id="node-input-saturday"> <label for="node-input-saturday" data-i18n="ha-time.label.saturday"></label></div></div></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled">Show Debug Information</label></div></script>
<script type="text/html" data-template-name="trigger-state"><input type="hidden" id="node-input-version"> <input type="hidden" id="node-input-inputs"> <input type="hidden" id="node-input-outputs"><!-- Name --><div class="form-row"><label for="node-input-name" data-i18n="home-assistant.label.label"></label> <input type="text" id="node-input-name"></div><!-- Server --><div class="form-row"><label for="node-input-server" data-i18n="home-assistant.label.server"></label> <input type="text" id="node-input-server"></div><!-- Entity ID Filter and Filter Type --><div class="form-row"><label for="node-input-entityid" data-i18n="home-assistant.label.entity"></label> <select type="text" id="node-input-entityidfiltertype"><option value="exact" data-i18n="home-assistant.label.select_option.exact"></option><option value="list" data-i18n="home-assistant.label.select_option.list"></option><option value="regex" data-i18n="home-assistant.label.select_option.regex"></option><option value="substring" data-i18n="home-assistant.label.select_option.substring"></option></select></div><div class="form-row"><label for="node-input-state_type" data-i18n="home-assistant.label.state_type"></label> <select type="text" id="node-input-state_type"><option value="str" data-i18n="home-assistant.label.select_option.string"></option><option value="num" data-i18n="home-assistant.label.select_option.number"></option><option value="habool" data-i18n="home-assistant.label.select_option.boolean"></option></select></div><!-- Constraints List --><div class="form-row"><ol id="constraint-list"></ol></div><!-- Output List --><div class="form-row"><ol id="output-list"></ol></div><div class="form-row checkbox-option-left"><input type="checkbox" id="node-input-outputinitially"> <label for="node-input-outputinitially" data-i18n="home-assistant.label.output_on_connect"></label></div><div class="form-row checkbox-option-left"><input type="checkbox" id="node-input-enableInput"> <label for="node-input-enableInput" data-i18n="trigger-state.label.enable_input"></label></div><div class="form-row checkbox-option-left"><input type="checkbox" id="node-input-debugenabled"> <label for="node-input-debugenabled" data-i18n="home-assistant.label.output_debug"></label></div><div id="constraint-template" style="display:none"><!-- Target Selection --><div class="editable-list-row"><!-- Type --> <select type="text" class="target-type" style="width:140px"><option value="this_entity" data-i18n="trigger-state.label.select_option.this_entity"></option><option value="entity_id" data-i18n="trigger-state.label.select_option.entity_id"></option></select><!-- Value --> <input type="text" class="target-value" disabled="disabled"></div><!-- Property Selection --><div class="editable-list-row"><!-- Type --> <select type="text" class="property-type" style="width:140px"><option value="current_state" data-i18n="trigger-state.label.select_option.current_state"></option><option value="previous_state" data-i18n="trigger-state.label.select_option.previous_state"></option><option value="property" data-i18n="trigger-state.label.select_option.property"></option></select><!-- Value --> <input type="text" class="property-value" disabled="disabled"></div><!-- Comparator Selection --><div class="editable-list-row"><!-- Type --> <select type="text" class="comparator-type" style="width:140px"><option value="is" data-i18n="home-assistant.label.select_option.is"></option><option value="is_not" data-i18n="home-assistant.label.select_option.is_not"></option><option value=">" data-i18n="home-assistant.label.select_option.greater_than"></option><option value=">=" data-i18n="home-assistant.label.select_option.greater_than_equal"></option><option value="<" data-i18n="home-assistant.label.select_option.less_than"></option><option value="<=" data-i18n="home-assistant.label.select_option.less_than_equal"></option><option value="includes" data-i18n="home-assistant.label.select_option.in"></option><option value="does_not_include" data-i18n="home-assistant.label.select_option.not_in"></option></select><!-- Value --> <input type="text" class="comparator-value" style="width:65%"></div></div><div id="output-template" style="display:none"><div class="editable-list-row"><!-- Type --> <select type="text" class="message-type" style="width:140px"><option value="default" data-i18n="trigger-state.label.select_option.default_message"></option><option value="custom" data-i18n="trigger-state.label.select_option.custom_message"></option><option value="payload" data-i18n="trigger-state.label.select_option.custom_payload"></option></select> <input type="text" class="message-value" style="width:62%"></div><!-- Output Comparator Selection --><div class="editable-list-row"><select type="text" class="comparator-property-type" style="width:140px"><option value="always" data-i18n="trigger-state.label.select_option.awalys"></option><option value="current_state" data-i18n="trigger-state.label.select_option.if_state"></option><option value="previous_state" data-i18n="trigger-state.label.select_option.if_prev_state"></option><option value="property" data-i18n="trigger-state.label.select_option.if_property"></option></select> <input type="text" class="comparator-property-value" disabled="disabled"></div><div class="editable-list-row"><!-- Type --> <select type="text" class="comparator-type" style="width:140px" disabled="disabled"><option value="is" data-i18n="home-assistant.label.select_option.is"></option><option value="is_not" data-i18n="home-assistant.label.select_option.is_not"></option><option value=">" data-i18n="home-assistant.label.select_option.less_than"></option><option value=">=" data-i18n="home-assistant.label.select_option.less_than_equal"></option><option value="<" data-i18n="home-assistant.label.select_option.greater_than"></option><option value="<=" data-i18n="home-assistant.label.select_option.greater_than_equal"></option><option value="includes" data-i18n="home-assistant.label.select_option.in"></option><option value="does_not_include" data-i18n="home-assistant.label.select_option.not_in"></option></select> <input type="text" class="comparator-value" style="width:62%"></div></div></script>
<script type="text/html" data-template-name="ha-wait-until"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name" data-i18n="home-assistant.label.name"></label> <input type="text" id="node-input-name"></div><div class="form-row"><label for="node-input-server" data-i18n="home-assistant.label.server"></label> <input type="text" id="node-input-server"></div><div class="form-row"><label data-i18n="home-assistant.label.entity"></label> <select id="node-input-entityIdFilterType"><option value="exact" data-i18n="home-assistant.label.select_option.exact">exact</option><option value="list" data-i18n="home-assistant.label.select_option.list">list</option><option value="regex" data-i18n="home-assistant.label.select_option.regex">regex</option><option value="substring" data-i18n="home-assistant.label.select_option.substring">substring</option></select></div><div class="form-row"><label for="node-input-property" data-i18n="ha-wait-until.label.wait_until"></label> <input type="text" id="node-input-property" placeholder="property"></div><div class="form-row"><label></label>&nbsp;<div class="ha-multi-item-row"><select id="node-input-comparator"><option value="is" data-i18n="home-assistant.label.select_option.is"></option><option value="is_not" data-i18n="home-assistant.label.select_option.is_not"></option><option value="lt" data-i18n="home-assistant.label.select_option.less_than"></option><option value="lte" data-i18n="home-assistant.label.select_option.less_than_equal"></option><option value="gt" data-i18n="home-assistant.label.select_option.greater_than"></option><option value="gte" data-i18n="home-assistant.label.select_option.greater_than_equal"></option><option value="includes" data-i18n="home-assistant.label.select_option.in"></option><option value="does_not_include" data-i18n="home-assistant.label.select_option.not_in"></option><option value="jsonata" data-i18n="home-assistant.label.select_option.jsonata"></option></select> <input id="node-input-valueType" type="hidden"> <input id="node-input-value" type="text" placeholder="value"></div></div><div class="form-row"><label for="node-input-timeout" data-i18n="ha-wait-until.label.timeout"></label>&nbsp;<div class="ha-multi-item-row"><input type="text" id="node-input-timeout"> <input type="hidden" id="node-input-timeoutType"> <select id="node-input-timeoutUnits"><option value="milliseconds" data-i18n="home-assistant.label.milliseconds">milliseconds</option><option value="seconds" data-i18n="home-assistant.label.seconds">seconds</option><option value="minutes" data-i18n="home-assistant.label.minutes">minutes</option><option value="hours" data-i18n="home-assistant.label.hours">hours</option><option value="days" data-i18n="home-assistant.label.days">days</option></select></div></div><div class="form-row"><label for="node-input-entityLocation" data-i18n="ha-wait-until.label.entity_location"></label> <input type="hidden" id="node-input-entityLocationType"> <input type="text" id="node-input-entityLocation" style="width:70%"></div><div class="form-row exact-only checkbox-option"><input type="checkbox" id="node-input-checkCurrentState" checked="checked"> <label for="node-input-checkCurrentState" data-i18n="ha-wait-until.label.check_current_state"></label></div><div class="form-row checkbox-option"><input type="checkbox" id="node-input-blockInputOverrides">&nbsp; <label for="node-input-blockInputOverrides" data-i18n="ha-wait-until.label.block_input_overrides"></label></div></script>
<script type="text/html" data-template-name="ha-webhook"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name">Name</label> <input type="text" id="node-input-name" placeholder="Name"> <input type="hidden" id="node-input-outputs"></div><div class="form-row"><label for="node-input-server">Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><label for="node-input-webhookId">ID</label>&nbsp;<div style="display:inline-flex;width:70%"><input type="text" id="node-input-webhookId" style="flex-grow:1"> <a id="copyId" class="editor-button" style="margin-left:10px"><i class="fa fa-copy"></i> </a><a id="refresh" class="editor-button" style="margin-left:10px"><i class="fa fa-refresh"></i></a></div></div><div class="form-row"><ol id="custom-outputs"></ol></div></script>
<script type="text/html" data-template-name="ha-zone"><input type="hidden" id="node-input-version"><div class="form-row"><label for="node-input-name"><i class="fa fa-tag"></i> Name</label> <input type="text" id="node-input-name" placeholder="Name"></div><div class="form-row"><label for="node-input-server"><i class="fa fa-server"></i> Server</label> <input type="text" id="node-input-server"></div><div class="form-row"><ol id="entities"></ol></div><div class="form-row"><label for="node-input-event"><i class="fa fa-sign-in"></i> Event</label> <select id="node-input-event"><option value="enter">Enter</option><option value="leave">Leave</option><option value="enter_leave">Enter or Leave</option></select></div><div class="form-row"><ol id="zones"></ol></div></script>
<script type="text/html" data-help-name="ha-api"><h3>Config</h3><dl class="message-properties"><dt>Protocol <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Values: <code>websocket|http</code></li><li>Default: <code>websocket</code></li></ul><dd>Protocol to use to access Home Assistant API.</dd><dt>Method<span class="property-type">string</span></dt><ul><li>Values: <code>get|post</code></li></ul><dd>Type of method to use to access the HTTP endpoint.</dd><dt>Path<span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>URL of the API endpoint.</dd><dt>Params<span class="property-type">Object</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>A JSON object with key/value pairs that will be converted into URL parameters.</dd><dt>Data<span class="property-type">Object</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a> when the data type is JSON</li></ul><dd>JSON Object to send for WebSocket requests and HTTP posts.</dd><dt>Results<span class="property-type">string</span></dt></dl><h3>Input</h3><dl class="message-properties"><dd>All properties need to be under <code>msg.payload</code>.</dd><dt>protocol<span class="property-type">string</span></dt><ul><li>Values: <code>websocket|http</code></li></ul><dd>Overrides or sets the protocol property of the config.</dd><dt>method<span class="property-type">string</span></dt><ul><li>Values: <code>get|post</code></li></ul><dd>Overrides or sets the method property of the config.</dd><dt>path<span class="property-type">string</span></dt><dd>Overrides or sets the path property of the config.</dd><dt>data<span class="property-type">Object|string</span></dt><dd>Overrides or sets the data/params property of the config.</dd><dt>location<span class="property-type">string</span></dt><dd>Overrides or sets the results property of the config.</dd><dt>locationType<span class="property-type">string</span></dt><ul><li>Values: <code>msg|flow|global</code></li></ul><dd>Overrides or sets the results type property of the config.</dd></dl><h3>Output</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>results</code>: results of the API request</li><li><code>config</code>: config properties of the node</li></ul></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://developers.home-assistant.io/docs/api/rest">http api</a></li><li><a href="https://developers.home-assistant.io/docs/api/websocket">websocket api</a></li></ul></dl></script>
<script type="text/html" data-help-name="ha-button"><p>Creates a <a href="https://developers.home-assistant.io/docs/core/entity/button">button entity</a> in Home Assistant that will trigger the flow when pressed.</p><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>entity</code>: full entity object</li><li><code>entity id</code>: entity id of the pressed button</li><li><code>entity state</code>: entity state of the pressed button</li><li><code>config</code>: config properties of the node</li></ul></dl></script>
<script type="text/html" data-help-name="api-call-service"><p>Sends a request to home assistant for any domain and service available (<code>light/turn_on</code>, <code>input_select/select_option</code>, etc..)</p><div class="home-assistant-custom-block tip"><p class="custom-block-title">Helpful Examples</p><p><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/call-service.html" rel="noopener noreferrer">Call Service Tips and Tricks</a></p></div><h3>Configuration</h3><dl class="message-properties"><dt>Domain <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>Service domain to call</dd><dd>A custom domain can be used by adding a <code>#</code> at the end of the domain</dd><dt>Service <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>Service to call</dd><dd>Custom service can be used by adding a <code>#</code> at the end of the service</dd><dt>Area<span class="property-type">an array of area ids</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a> for ids</li></ul><dd>A list of area ids that will be used as targets for the service call</dd><dd>Custom ids can be inserted into the list by adding a <code>#</code> at the end of the id</dd><dt>Device<span class="property-type">an array of device ids</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a> for ids</li></ul><dd>A list of device ids that will be used as targets for the service call</dd><dd>Custom ids can be inserted into the list by adding a <code>#</code> at the end of the id</dd><dt>Entity<span class="property-type">an array of entity ids</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a> for ids</li></ul><dd>A list of entity ids that will be used as targets for the service call</dd><dd>Custom ids can be inserted into the list by adding a <code>#</code> at the end of the id</dd><dt>Data<span class="property-type">JSONata | JSON</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a> when data type is JSON</li></ul><dd>JSON object to pass along.</dd><dt>Merge Context<span class="property-type">string</span></dt><dd>If defined will attempt to merge the global and flow context variable into the config</dd><dt>Alternative Template Tags<span class="property-type">boolean</span></dt><dd>Will change the tags used for the mustache template to <code>&lt;%</code> and <code>%&gt;</code></dd><dt>Queue<span class="property-type">none | first | all | last</span></dt><dd>Will store the first, last, or all messages received while disconnected from Home Assistant and send them once connected again</dd></dl><h3>Input</h3><dl class="message-properties"><dd>All properties need to be under <code>msg.payload</code>.</dd><dd>Sample input</dd><pre><code class="language-JSON">{
    &quot;domain&quot;: &quot;homeassistant&quot;,
    &quot;service&quot;: &quot;turn_on&quot;,
    &quot;target&quot;: {
        &quot;area_id&quot;: [&quot;kitchen&quot;],
        &quot;device_id&quot;: [&quot;8932894082930482903&quot;],
        &quot;entity_id&quot;: [&quot;light.kitchen&quot;, &quot;switch.garage_light&quot;]
    }
    &quot;data&quot;: {
        &quot;brightness_pct&quot;: 50
    }
}
</code></pre><h5>Merging</h5><dd>If the incoming message has a <code>payload</code> property with <code>domain</code>, <code>service</code> set it will override any config values if set.</dd><dd>If the incoming message has a <code>payload.data</code> that is an object or parsable into an object these properties will be <strong>merged</strong> with any config values set.</dd><dd>If the node has a property value in its config for <code>Merge Context</code> then the <code>flow</code> and <code>global</code> contexts will be checked for this property which should be an object that will also be merged into the data payload.</dd><h5>Merge Resolution</h5><dd>As seen above the <code>data</code> property has a lot going on in the way of data merging, in the end, all of these are optional and the rightmost will win if a property exists in multiple objects</dd><dd>Config Data, Global Data, Flow Data, Payload Data ( payload data property always wins if provided</dd><dt>domain<span class="property-type">string</span></dt><dd>Service domain to call</dd><dt>service<span class="property-type">string</span></dt><dd>Service service to call</dd><dt>data<span class="property-type">JSON Object</span></dt><dd>Service data to send with the service call</dd><dt>target<span class="property-type">JSON Object with area_id, device_id, and entity_id as array properties</span></dt><dd>Targets of the service call</dd></dl><h3>Output</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>sent data</code>: data sent to Home Assistant</li><li><code>config</code>: config properties of the node</li></ul></dl><h3>References</h3><dl class="message-properties"><div><p><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/node/call-service.html" rel="noopener noreferrer">External Docs</a></p></div></dl></script>
<script type="text/html" data-help-name="server"><p>Home Assistant connection configuration</p><h3>Config</h3><dl class="message-properties"><dt>Name<span class="property-type">string</span></dt><dd>Label for this configuration, see details below for implications</dd><dt>Hass.io<span class="property-type">boolean</span></dt><dd>If you&apos;re running Node-RED as a Hass.io Add-on check this. No other information is needed.</dd><dt>Base URL<span class="property-type">string</span></dt><dd>The base URL and port the home assistant instance can be reached at, for example: <code>http://192.168.0.100:8123</code> or <code>https://homeassistant.mysite.com</code></dd><dt>Access Token<span class="property-type">string</span></dt><dd>Long-lived Access Token used to contact the API</dd><dt>Unauthorized SSL Certificates<span class="property-type">boolean</span></dt><dd>This will allow you to use self-signed certificates. Only use this if you know what you&apos;re doing.</dd><dt>State Boolean<span class="property-type">string | delimited</span></dt><dd>A list of strings, not case sensitive, delimited by vertical pipe, |, that will return true for State Type Boolean.</dd><dt>Cache Autocomplete Results<span class="property-type"></span></dt><dd>Enables the caching of the JSON autocomplete requests. Enabling or disabling this may require a restart of Node-RED for it to take effect.</dd><dt>Enable Heartbeat<span class="property-type"></span></dt><dd>Heartbeat will send a ping message using the websocket connection to Home Assistant every X seconds. If a pong response is not received within a 5 seconds Node-RED will attempt to reconnect to Home Assistant.</dd><dt>Heartbeat Interval<span class="property-type"></span></dt><dd>The interval at which the ping message is sent to Home Assistant. The mininum value is 10 seconds.</dd></dl><h3>Details</h3><dl class="message-properties"><dd>Every node requires a configuration attached to define how to contact Home Assistant, which is this config node&apos;s main purpose.</dd><dt>Context<span class="property-type"></span></dt><dd>Each config node will also make some data available on the global context, the <code>Name</code> value in this node is used as, camelcase, the namespace for those values</dd><dd>Currently <code>states</code>, <code>services</code> and <code>events</code> is made available on the global context. <code>states</code> is always set to all available states at startup and updated whenever state changes occur so it should be always up to date. <code>services</code> and <code>events</code> is only updated on initial deploy.</dd><dt>Context Example<span class="property-type"></span></dt><dd>Say we have a config node with the name <code>Home Assistant</code>, with an entity set up in Home Assistant as <code>switch.my_switch</code>. This state would be available within function nodes and you could fetch using something like the below code</dd><pre><code class="language-js">const haCtx = global.get(&quot;homeassistant&quot;);
const configCtx = haCtx.homeAssistant;
const entityState = configCtx.states[&quot;switch.my_switch&quot;];
return entityState.state === &quot;on&quot; ? true : false;
</code></pre></dl><h3>Connection Issues</h3><dl class="message-properties"><dd>Communication with Home Assistant is accomplished via a combination of WebSocket and the REST API if you are having troubles communicating with home assistant make sure you can access the API outside of node-red, but from the same server node-red is running on, using a REST client, curl, or any number of other methods to validate the connection</dd></dl><h3>References</h3><dl class="message-properties"><dd><a href="https://home-assistant.io/developers/rest_api">Home Assistant REST API</a></dd></dl></script>
<script type="text/html" data-help-name="api-current-state"><p>Returns the current state of an entity. Useful for using conditional logic to automation flows.</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity ID <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>The id of the entity to return.</dd><dt>If State<span class="property-type">string</span></dt><dd>If the conditional statement is evaluated as true send the message to the first output otherwise send it to the second output. If blank there will only be one output.</dd><dd><strong>Also see:</strong></dd><ul><li><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/conditionals.html" rel="noopener noreferrer">Conditionals</a></li></ul><dt>For<span class="property-type">number</span></dt><dd>The amount of time the entity state needs to constant for the &quot;If state&quot; to be <code>true</code></dd><dt>State Type<span class="property-type">string</span></dt><ul><li>Values: <code>string|number|boolean</code></li><li>Default: <code>string</code></li></ul><dd>Convert the state of the entity to the selected type. Boolean will be converted to true based on if the string is equal by default to (<code>y|yes|true|on|home|open</code>). Original value stored in <code>msg.data.original_state</code></dd><dt>Block Input Overrides<span class="property-type">boolean</span></dt><ul><li>Default: <code>false</code></li></ul><dd>Stop msg.payload values from overriding local config</dd></dl><h3>Inputs</h3><dl class="message-properties"><dt>payload.entity_id<span class="property-type">string</span></dt></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>entity</code>: full entity object</li><li><code>entity id</code>: entity id of the triggered entity</li><li><code>entity state</code>: entity state of the triggered entity</li><li><code>config</code>: config properties of the node</li></ul></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/state_object/">Home Assistant State Objects</a></li></ul></dl></script>
<script type="text/html" data-help-name="ha-device"><h3>Configuration</h3><dl class="message-properties"><dt>Type<span class="property-type">string</span></dt><ul><li>Values: <code>trigger | action</code></li></ul><dt>Device<span class="property-type">string</span></dt><dd>Id of the device</dd><dt>Trigger<span class="property-type">object</span></dt><dd>Home Assistant object of the trigger</dd><dt>Action<span class="property-type">object</span></dt><dd>Home Assistant object of the action</dd><dt>Capabilities<span class="property-type">object</span></dt></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>config</code>: config properties of the node</li><li><code>device id</code>: device id that triggered the node</li><li><code>event data</code>: event data received from Home Assistant</li><li><code>sent data</code>: data sent to Home Assistant</li></ul></dl></script>
<script type="text/html" data-help-name="ha-entity-config"><p>Home Assistant entity config</p></script>
<script type="text/html" data-help-name="ha-entity"><p>Creates an entity in Home Assistant which can be manipulated from this node.</p><p><code>binary sensor</code>, <code>sensor</code>, and <code>switch</code></p><div class="home-assistant-custom-block warning"><p class="custom-block-title">WARNING</p><p><em>Needs <a href="https://github.com/zachowj/hass-node-red">Custom Integration</a> installed in Home Assistant for this node to function</em></p></div><h3>Configuration</h3><dl class="message-properties"><dt>Type <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Values <code>binary_sensor|sensor|switch</code></li><li>Default: <code>sensor</code></li></ul><dd>The state the entity should be updated to</dd><dt>Home Assistant Config<span class="property-type">Object</span></dt><dd>Configuration options available for the selected entity</dd><div class="home-assistant-custom-block danger"><p class="custom-block-title">WARNING</p><p>Entity nodes will not work in a subflow due to the way they register themselves with Home Assistant. After a Node-RED restart, a new entity will be created in Home Assistant.</p></div></dl><h3>Sensor Configuration</h3><dl class="message-properties"><dt>State <span text="required" class="home-assistant-badge">required</span><span class="property-type">string | number | boolean</span></dt><dd>The state the entity should be updated to</dd><dt>Attributes<span class="property-type">Object</span></dt><dd>Key/Value pair of attributes to update. The key should be a string and the value can be a [string | number | boolean | object]</dd><dt>Input Override<span class="property-type">string</span></dt><ul><li>Values: <code>accept | merge | block</code></li></ul><dd>Determine how input values will be handled. When merge is selected the message object values will override the configuration values.</dd><dt>Resend state and attributes<span class="property-type">boolean</span></dt><dd>When creating the entity in Home Assistant this will also send the last updated state and attributes then node sent to Home Assistant</dd></dl><h3>Switch Configuration</h3><dl class="message-properties"><dt>Output on state change<span class="property-type">boolean</span></dt><dd>When the state of the switch changes it will output to the top if the switch is on or to the bottom if it is in the off position.</dd><dt>Payload<span class="property-type">str | num | bool | JSONata | timestamp</span></dt><dd>Customizable output set to <code>msg.payload</code> if <code>Output on state change</code> is enabled.</dd></dl><h3>Sensors Inputs</h3><dl class="message-properties"><dd>properties of <code>msg.payload</code></dd><dt>state<span class="property-type">string | number | boolean</span></dt><dd>The state the entity should be updated to</dd><dt>attributes<span class="property-type">Object</span></dt><dd>Key/Value pair of attributes to update. The key should be a string and the value can be a <code>[string | number | boolean | object]</code></dd></dl><h3>Switch Inputs</h3><dl class="message-properties"><dt>msg.enable<span class="property-type">boolean</span></dt><dd>Set to <code>true</code> to turn on the switch and <code>false</code> to turn off. If the message has a property <code>enable</code> set to the type <code>boolean</code> the node will not have any output.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd><strong>Status Color</strong></dd><ul><li>Green/Red: output from the node was due to input to the node</li><li>Blue: output from the node was due to the state of the node changing</li><li>Yellow: state of node changed but no output</li></ul></dl></script>
<script type="text/html" data-help-name="server-events"><p>Listens for all types of events from Home Assistant with the ability to filter by event type.</p><h3>Configuration</h3><dl class="message-properties"><dt>Name<span class="property-type">string</span></dt><dd>the name of the node</dd><dt>Event Type<span class="property-type">string</span></dt><dd>filter by event type or leave blank for all events</dd><div class="home-assistant-custom-block danger"><p class="custom-block-title">WARNING</p><p>Leaving this empty will listen for all events from Home Assistant which may overload the WebSocket message queue.</p><p><a href="https://github.com/zachowj/node-red-contrib-home-assistant-websocket/issues/153#issuecomment-539290950">GitHub Issue #153</a></p></div><dt>Output only after Home Assistant is running<span class="property-type">boolean</span></dt><dd>What until Home Assistant has reported its state as <code>running</code> before outputing events. Client events will always output.</dd><dt>Expose to Home Assistant<span class="property-type">boolean</span></dt><dd>Creates a switch within Home Assistant to enable/disable this node. This feature requires <a href="https://github.com/zachowj/hass-node-red">Node-RED custom integration</a> to be installed in Home Assistant</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>event data</code>: event received from Home Assistant</li><li><code>config</code>: config properties of the node</li></ul></dl><h3>Client Events</h3><dl class="message-properties"><dd>Use <code>home_assistant_client</code> as the event type to receive events from the Websocket client.</dd><dd>Events sent from the client:</dd><ul><li><strong>connecting</strong> - when trying to connect to HA</li><li><strong>connected</strong> - after the authorization has been accepted</li><li><strong>disconnected</strong> - when the socket stops attempting to connect or disconnected after having been connected</li><li><strong>error</strong> - when a disconnect happens of the WebSocket with an error</li><li><strong>states_loaded</strong> - the first time all states are loaded from HA</li><li><strong>services_loaded</strong> - the first time all services are loaded from HA</li><li><strong>running</strong> - when HA is in a running state and states have been loaded</li></ul></dl></script>
<script type="text/html" data-help-name="server-state-changed"><p>Outputs state_changed event types sent from Home Assistant</p><p>The autocomplete will open to allow easier selection in the case you want a specific entity however the actual match is a substring match so no validation is done</p><h3>Configuration:</h3><dl class="message-properties"><dt>Entity ID <span text="required" class="home-assistant-badge">required</span><span class="property-type">string|regex</span></dt><dd>matches for entity_id field</dd><dd>Custom ids can be inserted into the list by adding a <code>#</code> at the end of the id</dd><dt>Entity ID Filter Types <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Values: <code>exact|substring|regex</code></li><li>Default: <code>exact</code></li></ul><dd>Substring can be a comma-delimited list.</dd><dt>If State<span class="property-type">string</span></dt><dd>If the conditional is evaluated as true send the message to the first output otherwise send it to the second output. If blank there will only be one output.</dd><dd><strong>Also see:</strong></dd><ul><li><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/conditionals.html" rel="noopener noreferrer">Conditionals</a></li></ul><dt>For<span class="property-type">number</span></dt><dd>An amount of time an entity&apos;s state needs to be in that state before triggering.</dd><div class="home-assistant-custom-block warning"><p class="custom-block-title">WARNING</p><p>Output on Connect state changes will not start a timer.</p></div><dt>State Type<span class="property-type">string</span></dt><ul><li>Values: <code>string|number|boolean</code></li><li>Default: <code>string</code></li></ul><dd>Convert the state of the entity to the selected type. Boolean will be converted to true based on if the string is equal by default to (<code>y|yes|true|on|home|open</code>). Original value stored in msg.data.original_state</dd><dt>Ignore state change event<span class="property-type">boolean</span></dt><dd>A list of possible states that will be ignored.</dd><dt>Output on Connect<span class="property-type">boolean</span></dt><dd>Output once on startup/deploy</dd><dt>Expose to Home Assistant<span class="property-type">boolean</span></dt><dd>Creates a switch within Home Assistant to enable/disable this node. This feature requires <a href="https://github.com/zachowj/hass-node-red">Node-RED custom integration</a> to be installed in Home Assistant</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>event data</code>: full event object</li><li><code>entity id</code>: entity id of the triggered entity</li><li><code>entity state</code>: entity state of the triggered entity</li><li><code>config</code>: config properties of the node</li></ul></dl></script>
<script type="text/html" data-help-name="ha-fire-event"><p>Fire an event to Home Assistants event bus</p><h3>Configuration</h3><dl class="message-properties"><dt>Event <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><dd>Event name to fire</dd><dt>data<span class="property-type">Object</span></dt><dd>JSON object to pass along</dd></dl><h3>Inputs</h3><dl class="message-properties"><dd>If the incoming message has a <code>payload</code> property with <code>event</code> set it will override any config values if set. If the incoming message has a <code>payload.data</code> that is an object or parsable into an object these properties will be <strong>merged</strong> with any config values set. If the node has a property value in its config for <code>Merge Context</code> then the <code>flow</code> and <code>global</code> contexts will be checked for this property which should be an object that will also be merged into the data payload.</dd><dt>payload.event<span class="property-type">string</span></dt><dd>Event to fire</dd><dt>payload.data<span class="property-type">Object</span></dt><dd>Event data to send</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>payload.event_type<span class="property-type">string</span></dt><dd>Event Type that was fired</dd><dt>payload.data<span class="property-type">Object</span></dt><dd>The event <code>data</code> sent if one was used</dd></dl><h3>References</h3><dl class="message-properties"><dd><a href="https://developers.home-assistant.io/docs/en/dev_101_events.html#firing-events">Home Assistant Events</a></dd></dl></script>
<script type="text/html" data-help-name="ha-get-entities"><p>Get Entities based on search criteria</p><h3>Configuration</h3><dl class="message-properties"><dt>Search Criteria<span class="property-type"></span></dt><dd>All search criteria have to be true for an entity to be valid.</dd><dt>Property<span class="property-type"></span></dt><dd>Has autocompleted with all properties currently set on all loaded entities.</dd></dl><h3>Inputs</h3><dl class="message-properties"><dt>payload<span class="property-type">Object</span></dt><dd>Override config values by passing in a property with a valid value.</dd><ul><li>rules array<ul><li>property string</li><li>logic string</li><li>value string</li><li>valueType string</li></ul></li><li>outputType string</li><li>outputEmptyResults boolean</li><li>outputLocationType string</li><li>outputLocation string</li><li>outputResultscount number</li></ul></dl><h3>Outputs</h3><dl class="message-properties"><dt>Array<span class="property-type">Array</span></dt><dd>Sends an array of state objects from search criteria to the Output Location.</dd><dt>Count<span class="property-type">number</span></dt><dd>Return the total count of valid entities.</dd><dt>Random<span class="property-type">Object|Array</span></dt><dd>Return a random object or array from the available state objects to the Output Location. When <code>One Max Results</code> is selected it will return an object and when more than one is selected will always return an array of state objects.</dd><dt>Split<span class="property-type">msg</span></dt><dd>Sends a message for each state object. In the same format as if the split node was used.</dd></dl><h3>State Object Format</h3><dl class="message-properties"><dd>Sample output when the Output Type is an array:</dd><pre><code class="language-json">[
  {
    &quot;entity_id&quot;: &quot;light.kitchen&quot;,
    &quot;state&quot;: &quot;on&quot;,
    &quot;attributes&quot;: {
      &quot;brightness&quot;: 243,
      &quot;friendly_name&quot;: &quot;Kitchen Light&quot;,
      &quot;supported_features&quot;: 33,
      &quot;icon&quot;: &quot;mdi:light-switch&quot;
    },
    &quot;last_changed&quot;: &quot;2019-12-29T05:38:53.016984+00:00&quot;,
    &quot;last_updated&quot;: &quot;2019-12-29T05:38:53.016984+00:00&quot;,
    &quot;context&quot;: {
      &quot;id&quot;: &quot;6c16e348494c42fb8c8e8bda92b20fb2&quot;,
      &quot;parent_id&quot;: null,
      &quot;user_id&quot;: null
    },
    &quot;timeSinceChangedMs&quot;: 3466747
  }
]
</code></pre><dt>entity_id<span class="property-type">string</span></dt><dd>The entity to which this state belongs</dd><dt>state<span class="property-type">string</span></dt><dd>Main attribute state value, examples: &apos;on&apos;, &apos;off&apos;, &apos;home&apos;, &apos;open&apos;, &apos;closed&apos;, etc...</dd><dt>attributes<span class="property-type">Object</span></dt><dd>Supported attributes of state set by Home Assistant</dd><dt>last_changed<span class="property-type">string</span></dt><dd>ISO Date string of last time entity state changed</dd><dt>timeSinceChangedMs<span class="property-type">number</span></dt><dd>Milliseconds since last time entity state changed</dd><dt>last_updated<span class="property-type">string</span></dt><dd>ISO Date string of last time entity state was updated</dd><dt>context<span class="property-type">Object</span></dt><dd>Information on who/what changed the state of this object last.</dd></dl><h3>Examples</h3><dl class="message-properties"><div><p><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/node/get-entities.html#examples">link</a></p></div></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/state_object/">Home Assistant State Objects</a></li></ul></dl></script>
<script type="text/html" data-help-name="api-get-history"><p>Fetches history from Home Assistant (all history for the past day by default)</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity ID<span class="property-type">string</span></dt><dd>Exact entity_id to fetch history for must be an exact match as is passed directly to the Home Assistant.</dd><dt>Entity ID Type<span class="property-type">string</span></dt><ul><li>Values: <code>is</code> | <code>includes</code></li><li>Default: <code>is</code></li></ul><dd><code>is</code> or <code>includes</code> depending on the match type.</dd><div class="home-assistant-custom-block warning"><p class="custom-block-title">WARNING</p><p><code>includes</code> fetches all history for the time period then filters according to the value, this will be less performant than exact <code>is</code> matching</p></div><dt>Start Date<span class="property-type">string</span></dt><ul><li>Values: ISO Format Date</li><li>Default: 24 hours prior</li></ul><dd>Date to start fetching history from. Will override the configuration if passed in</dd><dd><strong>Also See:</strong></dd><ul><li><a href="https://en.wikipedia.org/wiki/ISO_8601">https://en.wikipedia.org/wiki/ISO_8601</a></li></ul><dt>End Date<span class="property-type">string</span></dt><ul><li>Values: ISO Format Date</li><li>Default: 24 hours from start date</li></ul><dd>The end date to fetch history too. Will override the configuration if passed in</dd><dd><strong>Also See:</strong></dd><ul><li><a href="https://en.wikipedia.org/wiki/ISO_8601">https://en.wikipedia.org/wiki/ISO_8601</a></li></ul><dt>Use Relative Time<span class="property-type">boolean</span></dt><ul><li>Default: <code>false</code></li></ul><dd>A checkbox to use relative time or not.</dd><dt>In the Last<span class="property-type">string</span></dt><dd>A time string that will be parsed the following keywords into time values.</dd><dd>Example: <code>4h 30m</code> = The last 4 hours and 30 minutes</dd><pre><code>ms, milli, millisecond, milliseconds - will parse to milliseconds
s, sec, secs, second, seconds - will parse to seconds
m, min, mins, minute, minutes - will parse to minutes
h, hr, hrs, hour, hours - will parse to hours
d, day, days - will parse to days
w, week, weeks - will parse to weeks
mon, mth, mths, month, months - will parse to months
y, yr, yrs, year, years - will parse to years
</code></pre><dt>Flatten Results<span class="property-type"></span></dt><dd>Instead of returning the data from home assistant ( array for each entity_id ) return one flattened array of one item per history entry</dd><dt>Output Types<span class="property-type">string</span></dt><ul><li>Values: <code>array</code> | <code>split</code></li><li>Default: <code>array</code></li></ul></dl><h3>Inputs</h3><dl class="message-properties"><dd>All properties of <code>msg.payload</code></dd><dt>entity_id<span class="property-type">string</span></dt><ul><li>Alias: <code>msg.entityid</code> <span type="warning" text="deprecated" class="home-assistant-badge warning">deprecated</span></li></ul><dt>startdate<span class="property-type">string</span></dt><ul><li>Values: ISO Format Date</li><li>Alias: <code>msg.startdate</code> <span type="warning" text="deprecated" class="home-assistant-badge warning">deprecated</span></li></ul><dt>enddate<span class="property-type">string</span></dt><ul><li>Values: ISO Format Date</li><li>Alias: <code>msg.enddate</code> <span type="warning" text="deprecated" class="home-assistant-badge warning">deprecated</span></li></ul><dt>relativetime<span class="property-type">string</span></dt><ul><li>Alias: <code>msg.relativetime</code> <span type="warning" text="deprecated" class="home-assistant-badge warning">deprecated</span></li></ul><dd>If <code>relativetime</code> exists <code>startdate</code> and <code>enddate</code> will be ignored.</dd><dt>flatten<span class="property-type">boolean</span></dt><ul><li>Alias: <code>msg.flatten</code> <span type="warning" text="deprecated" class="home-assistant-badge warning">deprecated</span></li></ul></dl><h3>Outputs</h3><dl class="message-properties"><dt>payload<span class="property-type">array</span></dt><dd>The history returned by home-assistant, which is an array of arrays where each array entry contains history objects for one particular entity</dd><dt>startdate<span class="property-type">string</span></dt><dd>ISO date string used to fetch history</dd><dt>enddate<span class="property-type">string</span></dt><dd>ISO date string used to fetch history</dd><dt>entity_id<span class="property-type">string</span></dt><dd>The entity id string used during fetch history call</dd><dd>Example output of <code>msg</code>:</dd><pre><code class="language-json">{
  &quot;startdate&quot;: &quot;2020-01-11T16:41:31.086Z&quot;,
  &quot;enddate&quot;: &quot;2020-01-14T16:41:31.086Z&quot;,
  &quot;entityid&quot;: &quot;light.kitchen_light&quot;,
  &quot;payload&quot;: [
    {
      &quot;attributes&quot;: {
        &quot;friendly_name&quot;: &quot;Kitchen Light&quot;,
        &quot;icon&quot;: &quot;mdi:light-switch&quot;,
      },
      &quot;context&quot;: {
        &quot;id&quot;: &quot;850e510e36fb494c9abc79e01e897d54&quot;,
        &quot;parent_id&quot;: null,
        &quot;user_id&quot;: null
      },
      &quot;entity_id&quot;: &quot;light.kitchen_light&quot;,
      &quot;last_changed&quot;: &quot;2019-12-28T06:47:28.618000+00:00&quot;,
      &quot;last_updated&quot;: &quot;2019-12-28T06:47:28.618000+00:00&quot;,
      &quot;state&quot;: &quot;off&quot;
    },
    {
      &quot;attributes&quot;: {
        &quot;brightness&quot;: 28,
        &quot;friendly_name&quot;: &quot;Kitchen Light&quot;,
        &quot;icon&quot;: &quot;mdi:light-switch&quot;,
      },
      &quot;context&quot;: {
        &quot;id&quot;: &quot;4d4abe29f2bc43dab39101193f1fefe4&quot;,
        &quot;parent_id&quot;: null,
        &quot;user_id&quot;: null
      },
      &quot;entity_id&quot;: &quot;light.kitchen_light&quot;,
      &quot;last_changed&quot;: &quot;2019-12-28T07:48:11.514137+00:00&quot;,
      &quot;last_updated&quot;: &quot;2019-12-28T07:48:11.514137+00:00&quot;,
      &quot;state&quot;: &quot;on&quot;
    },
    ...
  ]
}
</code></pre></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://www.home-assistant.io/integrations/history">Home Assistant History Component</a></li><li><a href="https://developers.home-assistant.io/docs/en/external_api_rest.html#get-apihistoryperiodlttimestamp">Home Assistant API: /api/history/period</a></li></ul></dl></script>
<script type="text/html" data-help-name="poll-state"><p>Polls for the state at regular intervals, optionally also outputting at the start and when the state changes. Useful for either alert for non-communicating devices (time since change &gt; 1 day for example) or dashboard graphs with consistent interval charts</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity ID <span text="required" class="home-assistant-badge">required</span><span class="property-type"></span></dt><dd>The entity id of the entity to poll for.</dd><dt>Update Interval<span class="property-type">number</span></dt><dd>The amount of time between checking/sending updates.</dd><dt>If State<span class="property-type">string</span></dt><dd>If the conditional statement is evaluated as true send the message to the first output otherwise send it to the second output. If blank there will only be one output.</dd><dd><strong>Also see:</strong></dd><ul><li><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/conditionals.html" rel="noopener noreferrer">Conditionals</a></li></ul><dt>State Type<span class="property-type">string</span></dt><dd>Convert the state of the entity to the selected type. Boolean will be converted to true based on if the string is equal by default to (y|yes|true|on|home|open). Original value stored in msg.data.original_state</dd><dt>Output Initially<span class="property-type">boolean</span></dt><dd>Output once on startup/deploy then on each interval</dd><dt>Expose to Home Assistant<span class="property-type">boolean</span></dt><dd>Creates a switch within Home Assistant to enable/disable this node. This feature requires <a href="https://github.com/zachowj/hass-node-red">Node-RED custom integration</a> to be installed in Home Assistant</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>topic<span class="property-type">string</span></dt><dd>entity_id of changed entity</dd><dt>payload.data<span class="property-type">object</span></dt><dd>The last known state of the entity</dd><dt>payload.data.timeSinceChanged<span class="property-type">string</span></dt><dd>Human readable format string of time since last updated, example &quot;1 hour ago&quot;</dd><dt>payload.data.timeSinceChangedMs<span class="property-type">number</span></dt><dd>Number of milliseconds since last changed</dd></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/state_object/">Home Assistant State Objects</a></li></ul></dl></script>
<script type="text/html" data-help-name="api-render-template"><p>Can either set the template in the node configuration or pass in the <code>msg.template</code> property of the incoming message. Passing template via <code>msg.template</code> will override the template string set in node configuration.</p><div class="home-assistant-custom-block tip"><p class="custom-block-title">NOTE:</p><p>The node will output any Home Assistant API errors for catching with the &apos;catch-all&apos; node</p></div><h3>Configuration</h3><dl class="message-properties"><dt>template<span class="property-type">string</span></dt><dd>Jinja template to be rendered, discarded if <code>msg.template</code> is provided via input msg</dd><dt>Template Location<span class="property-type"></span></dt><dd>Customizable location to output original template</dd><dt>Results<span class="property-type"></span></dt><dd>Customizable location to output rendered template</dd></dl><h3>Inputs</h3><dl class="message-properties"><dt>template<span class="property-type">string</span></dt><dd>Jinja template to be rendered</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>template<span class="property-type">string</span></dt><dd>The original template sent to Home Assistant for rendering</dd><dt>payload<span class="property-type">string</span></dt><dd>The rendered template</dd></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/templating/">Home Assistant Template Docs</a></li><li><a href="http://jinja.pocoo.org/docs/dev/templates/">Jinja Docs</a></li></ul></dl></script>
<script type="text/html" data-help-name="ha-tag"><p>Sends an output when Home Assistant receives a tag scanned event for a configured tag id.</p><h3>Configuration</h3><dl class="message-properties"><dt>Tags<span class="property-type">array</span></dt><dd>An array of tag ids to monitor for tag scanned events.</dd><dt>Devices<span class="property-type">array</span></dt><dd>An array of device ids to check when a configured tag is scanned.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>event data</code>: full event object</li><li><code>tag id</code>: tag id of the tag that was scanned.</li><li><code>config</code>: config properties of the node</li></ul><dt>event object<span class="property-type">object</span></dt><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>device_id</td><td>ID of the device that scanned the tag</td></tr><tr><td>tag_id</td><td>ID of the tag that was scanned</td></tr><tr><td>tag_name</td><td>Home Assistant name of the tag that was scanned</td></tr><tr><td>user_id</td><td>Home Assistant user ID on device that scanned the tag</td></tr></tbody></table></dl></script>
<script type="text/html" data-help-name="ha-time"><p>A node that can be scheduled to trigger at a future date and time from a Home Assistant entity.</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity Id<span class="property-type">string</span></dt><dd>A Home Assistant entity to be used when scheduling the node.</dd><dt>Property<span class="property-type">string</span></dt><dd>Which property of the entity to use to schedule the node.</dd><dd>The node will accept any date string that the javascript object accepts as a valid date. It will also accept a 24-hour time format with the seconds place optional.</dd><dd>examples:</dd><ul><li><code>2020-12-31T02:47:54.837Z</code></li><li><code>1609382842709</code></li><li><code>13:40</code></li><li><code>23:59:02</code></li></ul><dt>Offset<span class="property-type">number</span></dt><dd>A negative or positive number that will be added to the scheduled time.</dd><dt>Randomize time within the offset<span class="property-type">boolean</span></dt><dd>When selected the time to trigger will be random selected from the scheduled time to the +/- offset.</dd><dt>Payload<span class="property-type">string | number | boolean | object</span></dt><dd>The payload is fully customizable. The default will be a JSONata expression that outputs the entity state.</dd><dt>Repeat Daily<span class="property-type">boolean</span></dt><dd>If selected the node will only use the time portion of the date string to schedule the node and will trigger at that time each day. Otherwise, the node will only trigger once at the given day and time.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>topic<span class="property-type">string</span></dt><dd>The entity id in the configuration.</dd><dt>payload<span class="property-type">string | number | boolean | object</span></dt><dt>data<span class="property-type">object</span></dt><dd>The entity object of the entity in the configuration.</dd></dl></script>
<script type="text/html" data-help-name="trigger-state"><p>Much like the <code>State Changed Node</code> however, provides some advanced functionality around common automation use cases.</p><p>An advanced version of the <code>server:state-changed</code> node</p><!-- TODO: Needs a total rework --><h3>Configuration</h3><dl class="message-properties"><dt>Entity ID <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>The id of an entity to use for the comparison.</dd><dd>Custom ids can be inserted into the list by adding a <code>#</code> at the end of the id</dd><dt>Entity ID Filter Types <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Values: <code>exact|list|substring|regex</code></li><li>Default: <code>exact</code></li></ul><dt>State Type<span class="property-type">string</span></dt><ul><li>Values: <code>string|number|boolean</code></li><li>Default: <code>string</code></li></ul><dd>Convert the state of the entity to the selected type. Boolean will be converted to true based on if the string is equal by default to (<code>y|yes|true|on|home|open</code>). Original value stored in msg.data.original_state</dd><dt>Conditions<span class="property-type"></span></dt><dd>This node has two default outputs &quot;allowed&quot; and &quot;blocked&quot;. If all the conditions are true the default message will be sent to the &quot;allowed&quot; output otherwise, it will be sent to the &quot;blocked&quot; output.</dd><dd><strong>See Also:</strong></dd><ul><li><a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/conditionals.html" rel="noopener noreferrer">Conditionals</a></li></ul><dt>Custom Outputs<span class="property-type"></span></dt><dd>All the above conditions need to be true for any custom outputs to be sent, having zero conditions is a valid option. Each custom output can send the default message or a custom message. Also, each one can have its constraint on whether or not to be sent.</dd></dl><h3>Input</h3><dl class="message-properties"><dd>Input is disabled by default. It can be enabled using the <code>Enable Input</code> option.</dd><dt>Enable / Disable<span class="property-type">string</span></dt><dd>If the incoming payload or message is a string and equal to <code>enable</code> or <code>disable</code> then set the node accordingly. Saves over restarts.</dd><dt>Output Initially<span class="property-type">boolean</span></dt><dd>Output once on startup/deploy.</dd></dl><h3>Output</h3><dl class="message-properties"><dt>topic<span class="property-type">string</span></dt><dd>The entity_id that triggered the node</dd><dt>payload<span class="property-type">string</span></dt><dd>The state as sent by home assistant</dd><dt>data<span class="property-type">object</span></dt><dd>The original home assistant event containing <code>entity_id</code> <code>new_state</code> and <code>old_state</code> properties</dd></dl><h3>Testing</h3><dl class="message-properties"><dd>To test automation without having to manually change state in-home assistant send an input <code>payload</code> as an object which contains <code>entity_id</code>, <code>new_state</code>, and <code>old_state</code> properties. This will trigger the node as if the event came from Home Assistant.</dd><pre><code class="language-json">{
  &quot;entity_id&quot;: &quot;test_entity&quot;,
  &quot;old_state&quot;: {
    &quot;state&quot;: &quot;on&quot;
  },
  &quot;new_state&quot;: {
    &quot;state&quot;: &quot;off&quot;
  }
}
</code></pre></dl><h3>References</h3><dl class="message-properties"><ul><li><a href="https://home-assistant.io/docs/configuration/state_object">HA State Object</a></li></ul></dl></script>
<script type="text/html" data-help-name="ha-wait-until"><p>When an input is received the node will wait until the condition is met or the timeout occurs then will pass on the last received message. Any new input will reset the timeout timer.</p><h3>Configuration</h3><dl class="message-properties"><dt>Entity ID <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Accepts <a href="https://zachowj.github.io/node-red-contrib-home-assistant-websocket/guide/mustache-templates.html" rel="noopener noreferrer">Mustache Templates</a></li></ul><dd>The id of an entity to use for the comparison.</dd><dd>Custom ids can be inserted into the list by adding a <code>#</code> at the end of the id</dd><dt>Entity ID Filter Types <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><ul><li>Values: <code>exact|list|substring|regex</code></li><li>Default: <code>exact</code></li></ul><dt>Wait Until <span text="required" class="home-assistant-badge">required</span><span class="property-type">string</span></dt><dd>The <code>property</code> field will be checked against the <code>value</code> field using the comparator.</dd><dt>Timeout<span class="property-type">number</span></dt><dd>The amount of time to wait for the condition to become true before deactivating the node and passing the message object to the second output. If the timeout is equal to zero the node will wait indefinitely for the condition to be met.</dd><dt>Entity Location<span class="property-type">string</span></dt><dd>The entity object can also be passed with the message object.</dd><dt>Check against the current state<span class="property-type">boolean</span></dt><dd>When an input is received it will check the comparator against the current state instead of waiting for a state change.</dd></dl><h3>Input</h3><dl class="message-properties"><dt>reset<span class="property-type"></span></dt><dd>If the received message has this property set to any value the node will be set to inactive and the timeout cleared.</dd><dt>payload<span class="property-type">object</span></dt><dd>Override config values by passing in a property with a valid value.</dd><ul><li><code>entity_id</code></li><li><code>entityId</code> <span type="warning" text="deprecated" class="home-assistant-badge warning">deprecated</span></li><li><code>entityIdFilterType</code></li><li><code>property</code></li><li><code>comparator</code></li><li><code>value</code></li><li><code>valueType</code></li><li><code>timeout</code></li><li><code>timeoutUnits</code></li><li><code>entityLocation</code></li><li><code>entityLocationType</code></li><li><code>checkCurrentState</code></li></ul></dl><h3>Output</h3><dl class="message-properties"><dd>Will output the last received message when the condition is true or the timeout occurs. If the condition becomes true the message will be passed to the first output. If the timeout passes the message will be sent to the second output.</dd></dl></script>
<script type="text/html" data-help-name="ha-webhook"><p>Outputs the data received from the created webhook in Home Assistant</p><div class="home-assistant-custom-block warning"><p class="custom-block-title">WARNING</p><p><em>Needs <a href="https://github.com/zachowj/hass-node-red">Custom Integration</a> installed in Home Assistant for this node to function</em></p></div><h3>Configuration</h3><dl class="message-properties"><dt>ID<span class="property-type">string</span></dt><dd>A string to be used for the webhook URL in Home Assistant.</dd><dt>Payload<span class="property-type">string</span></dt><dd>Customizable location for the webhook payload. Defaults to msg.payload</dd><dt>Headers<span class="property-type">number</span></dt><dd>Customizable location for the webhook request headers.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dd>Value types:</dd><ul><li><code>received data</code>: The parsed body from the webhook request</li><li><code>trigger id</code>: webhook id</li><li><code>headers</code>: entity state of the triggered entity</li><li><code>params</code>: Query string parameters</li><li><code>config</code>: config properties of the node</li></ul></dl></script>
<script type="text/html" data-help-name="ha-zone"><p>Outputs when one of the configured entities enter or leaves one of the defined zones.</p><h3>Configuration</h3><dl class="message-properties"><dt>Entities<span class="property-type">array</span></dt><dd>An array of entity ids to monitor for zone changes.</dd><dt>Event<span class="property-type">string</span></dt><dd>Set when to check an entity. Either entering or leaving a zone.</dd><dt>Zones<span class="property-type">array</span></dt><dd>An array of zone ids to check when a configured entity updates.</dd></dl><h3>Outputs</h3><dl class="message-properties"><dt>topic<span class="property-type">string</span></dt><dd>The entity id of the device/person that triggered the update.</dd><dt>payload<span class="property-type">string</span></dt><dd>The state of the device/person entity that triggered the update.</dd><dt>data<span class="property-type">object</span></dt><dd>The entity object of the device/person that triggered the update.</dd><dt>zones<span class="property-type">array</span></dt><dd>An array of zone entities where the device/person entity entered/left after an update of location.</dd></dl></script>